"use strict";var r,h,e,n,t,a,s,o,i;!function(e){e.SRC_PROFILE="srcProfile",e.CORRELATION_ID="srccorrelationid",e.ACCESS_TOKEN="accesstoken",e.SRC_ID="consumerId",e.ID_TOKENS="idTokens",e.LOG_ID_TOKEN="LOG_ID_TOKEN",e.DPA_TRANSACTION_DATA="dpaTransactionOptions",e.DPA_DATA="dpaData",e.SRCI_DSA_ID="srciDpaId",e.TRANSACTION_ID="srciTransactionId",e.SRC_TRANSACTION_ID="srcsTransactionId",e.VERSION="sdk_version",e.INITIATOR_ID="srcInitiatorId",e.JSON_CONTENT_TYPE="application/json",e.EMAIL_ENC_LOOP_TIMES=1e3,e.AMEX_UNKOWN_RT="AMEX_UNKOWN_RT",e.API_TIMEOUT=1e4,e.INVALID_SRCI_ID="INVALID_SRCI_ID",e.MATCHED="MATCHED",e.NON_MATCHED="NON_MATCHED",e.MAT_NONMAT="MAT_NONMAT",e.MERCHANT_URL="merchantUrl",e.EXTENSIVE_LOGGING="extensiveLogging",e.CSRT_LOGGING="CSRT_LOGGING",e.SESSION_ID="session_id",e.INVALID_VERSION="invalid_version",e.THREEDS_TRANS_ID="threeDSServerTransID",e.PAYLOAD_TRANS_ID="payloadTransId",e.IGNORE_PAYLOAD="IGNORE_PAYLOAD",e.CSRT_EVENT="csrt_event_params",e.SDK_API_NAME={INIT:"init",IS_RECOGNIZED:"isRecognized",ID_LOOKUP:"identityLookup",GET_SRC_PROFILE:"getSrcProfile",INITIATE_ID_VALIDATION:"initiateIdentityValidation",COMPLETE_ID_VALIDATION:"completeIdentityValidation",CHECKOUT:"checkout",CHECKOUT_COMPLETE:"checkoutComplete",UNBIND:"unbindAppInstance"},e.DCF_PATH={ERROR:"/card-error",ADD_CARD:"/amex-card-details",SEND_OTP:"/verification-channel",REVIEW:"/review-and-confirm",CID:"/verify-the-card",BILLING:"/create-profile",SAFEKEY:"/safekey-challenge-result"};var n=function(){var e={},n=document.currentScript||document.querySelector('script[src*="amexSDK"]')||document.querySelector('script[src*="amexSS"]'),t="-qa",r=null,a="";if(n){var s=n.src,o=new URL(s);r=o.searchParams.get("env"),s.includes("cdaas-dev")?t="-dev":s.includes("qwww.aexp-static.com")?t="-qa":s.includes("www.aexp-static.com")&&(t=""),r&&(o.searchParams.delete("env"),t=r,s=String(o));var i=s.split("/").pop().split("-").pop().split(".");i.pop(),e.version=i.join(".")}return a="-dev"===t?"https://staging.cdn-net.com":"-qa"===t||"-green-qa"===t?"https://staging.cdn-net.com":"https://www.cdn-path.com",e.id="https://srcsidentity"+t+".americanexpress.com",e.pf="https://srcsprofile"+t+".americanexpress.com",e.ch="https://srcscheckout"+t+".americanexpress.com",e.dcf="https://srcdcf"+t+".americanexpress.com",e.log="https://srcservicing"+t+".americanexpress.com",e.csrt="https://srcservicing"+t+".americanexpress.com",e.keys="https://openid"+t+".americanexpress.com",e.safekey="https://srcsknotify"+t+".americanexpress.com",e.ping="https://srcskstatus"+t+".americanexpress.com",e.ia=a,e.epass=t,e.epaasRoute=r,e}();e.BASE_PROFILE_URL=n.pf,e.BASE_IDENTITY_URL=n.id,e.BASE_CHECKOUT_URL=n.ch,e.BASE_INAUTH_URL=n.ia,e.BASE_LOGGING_URL=n.log,e.BASE_CSRT_URL=n.csrt,e.BASE_KEYS_URL=n.keys,e.BASE_SAFEKEY_URL=n.safekey,e.BASE_PING_URL=n.ping,e.DCF_ENV=n.epass,e.EPAAS_ROUTE=n.epaasRoute,e.SDK_VERSION=n.version,e.CHECKOUT_RESPONSE="dcfActionCode",e.AMEX_DCF_URL=n.dcf,e.AMEX_SRCI_URL="*"}(r||(r={})),(h||(h={})).SDKErrorCodes={standardErrorCodes:{REQUEST_TIMEOUT:{reason:"REQUEST_TIMEOUT",message:"Service Timeout occurred"},SERVER_ERROR:{reason:"SERVER_ERROR",message:"General server error"},INVALID_PARAMETER:{reason:"INVALID_PARAMETER",message:"Request to the Service contains invalid parameters"}},init:{SRCI_ID_MISSING:{reason:"SRCI_ID_MISSING",message:"The identifier for the SRC Initiator is missing."},DSA_ID_MISSING:{reason:"DPA_ID_MISSING",message:"Both srciDpaId & srcDpaId is missing. There would be no way for an SRC System to identify the DPA."},SRCI_TXN_ID_MISSING:{reason:"SRCI_TXN_ID_MISSING",message:"srciTransactionId is missing."},VERSION_MISSING:{reason:"INVALID_VERSION_PARAMETER",message:"Version parameter is missing or invalid."}},identityLookup:{FRAUD:{reason:"FRAUD",message:"The user account was locked or disabled."},ID_FORMAT_UNSUPPORTED:{reason:"ID_FORMAT_UNSUPPORTED",message:"Unsupported Id format"},CONSUMER_ID_MISSING:{reason:"CONSUMER_ID_MISSING",message:"Consumer identity is missing in the request"},ACCT_INACCESSIBLE:{reason:"ACCT_INACCESSIBLE",message:"The account exists but is not currently accessible (e.g. is locked)"}},getSrcProfile:{AUTH_INVALID:{reason:"AUTH_INVALID",message:"Invalid Authorization"},ACCT_INACCESSIBLE:{reason:"ACCT_INACCESSIBLE",message:"The account exists but is not currently accessible (e.g. is locked)"},EMPTY_PROFILES:{reason:"EMPTY_PROFILES",message:"There are no profiles for received idTokens"}},initiateIdentityValidation:{OPT_SEND_FAILED:{reason:"OPT_SEND_FAILED",message:"The OTP could not be sent to the recipient."},RETRIES_EXCEEDED:{reason:"RETRIES_EXCEEDED",message:"The limit for the number of retries for OTP generation was exceeded."},ID_INVALID:{reason:"ID_INVALID",message:"Invalid ID."},UNRECOGNIZED_CONSUMER_ID:{reason:"UNRECOGNIZED_CONSUMER_ID",message:"Consumer ID could not be recognized."},ACCT_INACCESSIBLE:{reason:"ACCT_INACCESSIBLE",message:"The account exists but is not currently accessible (e.g. is locked)"}},completeIdentityValidation:{VALIDATION_DATA_MISSING:{reason:"VALIDATION_DATA_MISSING",message:"Validation data missing."},CODE_INVALID:{reason:"CODE_INVALID",message:"The supplied OTP value was invalid. Try again."},CODE_EXPIRED:{reason:"CODE_EXPIRED",message:"The OTP is expired. Regenerate the OTP and try again."},RETRIES_EXCEEDED:{reason:"RETRIES_EXCEEDED",message:"The limit for the number of retries for OTP generation was exceeded."},ACCT_INACCESSIBLE:{reason:"ACCT_INACCESSIBLE",message:"The account exists but is not currently accessible (e.g. is locked)"}},checkout:{CARD_ADD_FAILED:{reason:"CARD_ADD_FAILED",message:"Unable to add card."},CARD_SECURITY_CODE_MISSING:{reason:"CARD_SECURITY_CODE_MISSING",message:"Card security must be supplied."},CARD_INVALID:{reason:"CARD_INVALID",message:"Invalid card number."},CARDID_MISSING:{reason:"CARDID_MISSING",message:"The card ID was required but is missing."},CARD_EXP_INVALID:{reason:"CARD_EXP_INVALID",message:"Invalid card expiry date."},ACCT_INACCESSIBLE:{reason:"ACCT_INACCESSIBLE",message:"The account exists but is not currently accessible (e.g. is locked)"},UNABLE_TO_CONNECT:{reason:"UNABLE_TO_CONNECT",message:"Unable to connect to DCF."}},unbindAppInstance:{AUTH_INVALID:{reason:"AUTH_INVALID ",message:"Invalid Authorization "},CONSUMER_INACCESSIBLE:{reason:"CONSUMER_INACCESSIBLE ",message:"The consumer exists but is not currently accessible"},RT_VERIFICATION_FAILED:{reason:"RT_VERIFICATION_FAILED ",message:"Refresh token verification failed."},ID_TOKEN_VERIFICATION_FAILED:{reason:"ID_TOKEN_VERIFICATION_FAILED ",message:"Id token verification failed"}}},n=e||(e={}),(t=n.SplunkEventName||(n.SplunkEventName={})).Init="Init",t.IsRecognized="IsRecognized",t.GetSrcProfile="GetSrcProfile",t.IdLookup="IdLookup",t.InitIdValidation="InitIdValidation",t.CompleteIdValidation="CompleteIdValidation",t.Checkout="CheckoutStart",t.CheckoutComplete="CheckoutComplete",t.UnbindAppInstance="UnbindAppInstance",(a=n.SplunkApiName||(n.SplunkApiName={})).Init="Init",a.IsRecognized="IsRecognized",a.GetSrcProfile="GetSrcProfile",a.IdLookup="IdLookup",a.InitIdValidation="InitIdValidation",a.CompleteIdValidation="CompleteIdValidation",a.Checkout="Checkout",a.UnbindAppInstance="UnbindAppInstance",(s=n.SplunkEventStatus||(n.SplunkEventStatus={})).Success="SCS",s.Fail="FAL",(o=n.PromiseStatus||(n.PromiseStatus={})).Reject="REJ",o.Resolve="RES",(i=n.CsrtFieldName||(n.CsrtFieldName={})).sdk_err_cd="sdk_err_cd",i.sdk_err_desc="sdk_err_desc",i.is_recognized="is_recog",i.consumer_identity_value="consumer_identity_value",i.consumer_present="cons_present",i.supported_validation_channels_type="supported_validation_chan_type",i.masked_validation_channel="masked_validation_chan",i.auth_code_value="auth_code_val",i.no_of_profiles_returned="no_of_profiles_returned",i.matched_rt_cnt="matched_rt_cnt",i.non_matched_rt_cnt="non_matched_rt_cnt",i.src_digital_card_Id="src_digital_card_Id",i.encrypted_card="encrypted_card",i.dcf_action_code="dcf_act_cd",i.checkout_response_signature="checkout_response_sign",i.unbind_app_instance="unbind_app_inst",i.unbind_idtoken_cnt="unbind_idtoken_cnt";var _=function(){return(_=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},T=r.SRC_TRANSACTION_ID,E=r.INITIATOR_ID,C=r.ACCESS_TOKEN,R=r.LOG_ID_TOKEN,c=r.BASE_LOGGING_URL,v=e.SplunkEventName,A=r.DPA_TRANSACTION_DATA,N=r.CORRELATION_ID,O=r.VERSION,y=r.TRANSACTION_ID,w=r.DPA_DATA,D=r.CSRT_EVENT,d=r.CSRT_LOGGING,u=r.EXTENSIVE_LOGGING,k=r.BASE_CSRT_URL,p=[];var b,l,I=function(){try{0<p.length&&(p.map(function(e){f(e)}),p=[])}catch(e){console.log(e)}},f=function(e){try{var n=window.amexSrcInstance.getItem(T)||"",t=window.amexSrcInstance.getItem(E)||"",r=window.amexSrcInstance.getItem(C)||"",a=window.amexSrcInstance.getItem(R)||"",s=JSON.parse(window.amexSrcInstance.getItem(A)||"{}"),o="";s&&s.dpaLocale&&(o=s.dpaLocale);var i=new XMLHttpRequest;e.event.SrcsTransactionId=n,e.event.SrciInitiatorId=t,i.open("POST",c+"/v2/logger"),i.setRequestHeader("Accept","*/*"),i.setRequestHeader("Accept-Language","en"),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("SrcsTransactionId",n),e.event.eventName===v.Init?i.setRequestHeader("ApplicationName","src_init"):e.event.eventName===v.IsRecognized?i.setRequestHeader("ApplicationName","src_isRecognized"):e.event.eventName===v.GetSrcProfile&&(e.event.dpaLocale=o),a?i.setRequestHeader("IdToken",a):r&&i.setRequestHeader("AccessToken",r),i.send(JSON.stringify(e))}catch(e){console.log(e)}},m=function(e){try{if(e.eventName===v.Init||e.eventName===v.IsRecognized)return;var n=window.amexSrcInstance.getItem(T)||void 0,t=window.amexSrcInstance.getItem(y)||void 0,r=window.amexSrcInstance.getItem(E)||void 0,a=window.amexSrcInstance.getItem(N)||void 0,s=window.amexSrcInstance.getItem(O),o=JSON.parse(window.amexSrcInstance.getItem(A)||"{}"),i=JSON.parse(window.amexSrcInstance.getItem(w)||"{}"),c=window.amexSrcInstance.getItem(C)||"",d=b.generateUUID(),u=n+":"+d,p=window.amexSrcInstance.getItem(R)||"",l={event_Id:d,event_key:u,event_nm:e.eventName,event_type:"SDK_API",event_status:e.eventStatus,event_start_tm:new Date(e.eventStartTimestamp).toISOString(),event_end_tm:new Date(e.eventEndTimestamp).toISOString(),event_origin:"SDK",srci_trans_id:t,src_corel_id:a,srcs_trans_id:n,src_init_id:r};if(o&&o.dpaLocale&&(l.dpa_locale=o.dpaLocale),i){var I=i.dpaPresentationName,f=i.dpaUri;I&&(l.dpa_pres_nm=i.dpaPresentationName),f&&(l.dpa_url=i.dpaUri)}var m=JSON.parse(window.amexSrcInstance.getItem(D)||"{}"),S=e.eventName;m&&!b.isEmptyObject(m)&&m[S]&&(l=_({},l,m[S]));var g=new XMLHttpRequest;g.open("POST",k+"/analytics"),g.setRequestHeader("Accept","*/*"),g.setRequestHeader("Accept-Language","en"),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("SrcsTransactionId",n),g.setRequestHeader("SrcInitiatorId",r),g.setRequestHeader("SrcCorrelationId",a),g.setRequestHeader("SrciTransactionId",t),p?g.setRequestHeader("IdToken",p):c&&g.setRequestHeader("AccessToken",c),e.eventName===v.IsRecognized&&g.setRequestHeader("ApplicationName","src_isRecognized"),g.send(JSON.stringify({req_version:s,csrtEventData:l}))}catch(e){}};!function(e){var t=r.ACCESS_TOKEN,a=r.CSRT_EVENT;function n(e){return!e}function s(e){if(!e)return!0;for(var n in e)if(e.hasOwnProperty(n))return!1;return JSON.stringify(e)===JSON.stringify({})}e.storeHeader=function(e,n){e&&e.getResponseHeader(n)&&(window.amexSrcInstance.setItem(n,e.getResponseHeader(n)||""),n===t&&I())},e.add=function(e,n){return e+n},e.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})},e.generateSRCUUID=function(){return"SRC-xxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})},e.responsePromise=function(e){return delete e.resolveIndex,delete e.resolve,e.pandaYellow&&delete e.pandaYellow,e},e.isValidLuhn=function(e){var n,t,r,a,s=0;for(t=0,r=(a=e.split("").reverse().join("")).length;t<r;t++)n=+(n=a[t]),s+=t%2?(n*=2)<10?n:n-9:n;return s%10==0},e.cardYearMothValidation=function(e,n){var t=new Date;return t.setFullYear(Number(n),Number(e)-1,t.getDate()+1),t.getTime()>(new Date).getTime()},e.isCreditCard=function(e){if(19<e.length)return!1;for(var n=0,t=1,r=e.length,a=0;a<r;a++){var s=e.substring(r-a-1,r-a),o=parseInt(s,10)*t;n+=10<=o?o%10+1:o,1===t?t++:t--}return n%10==0},e.getTimeStamp=function(){return(new Date).getTime()},e.isEmptyString=n,e.isEmpty=function(e){return n(e)||s(e)},e.isEmptyObject=s,e.checkArrayOfStrings=function(e){return e.every(function(e){return"string"==typeof e})},e.getPropertyFromToken=function(e,n){var t=e&&JSON.parse(atob(e.split(".")[1]));return t&&t[n]?t[n]:null},e.getNavigatorLanguage=function(){return navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||""},e.stringToBool=function(e){return"true"==e},e.objectToBase64=function(e){return btoa(JSON.stringify(e))},e.initalizeCsrtEvent=function(e){var n;window.amexSrcInstance.setItem(a,JSON.stringify(((n={})[e]={},n)))},e.updateCsrtEvent=function(e,n,t){var r=JSON.parse(window.amexSrcInstance.getItem(a)||"{}");r&&!s(r)&&(r[t][e]=n),window.amexSrcInstance.setItem(a,JSON.stringify(r))},e.getChannelTypes=function(e){try{var n=[];return e&&e.forEach(function(e){-1===n.indexOf(e.validationType)&&n.push(e.validationType)}),n.length?n.join(" | "):null}catch(e){}}}(b||(b={})),function(e){var o=r.MERCHANT_URL,i=r.BASE_KEYS_URL,c=r.VERSION,s=function(e,n,t,r,a,s){this.url=e,this.method=n||"get",this.data=t||"",this.timeout=a||3e3,this.headers=r||{},this.async=s||!1};e.Options=s;var n=function(){var a=this;this.request=function(e,r,n){var t=window.amexSrcInstance.getItem(o),a=e.headers,s=window.amexSrcInstance.getItem(c);s&&(a.Accept="version="+s),t&&!e.url.includes(i)&&(a.MerchantUrl=t),$.ajax({url:e.url,type:e.method,data:e.data,headers:a,timeout:e.timeout,cache:!1,crossDomain:!0,async:e.async,success:function(e,n,t){r(e,n,t)},error:function(e){n&&n(e)}})},this.get=function(e,n,t){a.request(new s(e),n,t)},this.getWithDataInput=function(e,n,t,r){a.request(new s(e,"get",n),t,r)},this.post=function(e,n,t){a.request(new s(e,"post"),n,t)},this.postWithData=function(e,n,t,r){a.request(new s(e,"post",n),t,r)}};e.Service=n}(l||(l={}));var P=r.DCF_ENV;var x={sandbox:[{id:"d4f9feb0-177e-49bc-9dbc-94e8c98a3f14",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"26a64541-8e2f-4054-a5eb-e7ab3119216a",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"7f198f5f-579b-470f-8979-c0f2b1deebbe",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"4ea615ac-d117-4417-b5f9-a938858ca4a8",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"0a4771e3-6efa-45eb-bdad-108f5c610c8a",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"532d0f69-f2ac-4069-a322-ff8902361cf3",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"bb777a4f-f997-4f2b-8f9a-86cd6288dae5",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"a59fbdf1-d824-4076-a685-221db5e208f1",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"d1de035f-474e-47bc-89c6-5a073a1ba181",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"72e7a78f-d045-4576-b825-4628cf9b1f07",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"3f2e766c-482b-40db-8370-10514bd41218",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"d2e7d975-b0aa-4faa-9a51-68002290d756",default_version:"1.1",supported_versions:["0.9","1.1"]},{id:"8ec2c888-64cc-4efc-9175-b337452b28c8",default_version:"1.1",supported_versions:["0.9","1.1"]},{id:"231f8701-f249-45a8-9a06-5362e9f0d99e",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383ad",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a1",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a2",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a3",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a4",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a5",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"60b9b0b9-ea2a-4251-bc25-a2295b9e57a1",default_version:"1.1",supported_versions:["0.9","1.1"]}],production:[{id:"d4f9feb0-177e-49bc-9dbc-94e8c98a3f14",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"de601af5-f2db-45df-bc76-b516cdcdfc98",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"c47ea753-0c38-4a20-a0c1-b12752c86a50",default_version:"1.1",supported_versions:["0.9","1.1"]},{id:"2ca0a10a-1284-492f-a272-e1608d5cd54a",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"8a4117f6-47dd-4f57-a507-96ea58a2ba1f",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"d8daab1e-7213-48c3-8ff5-6628c7c29c9b",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a1",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a2",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a3",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a4",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"51c83b39-5c4b-4c82-a1c1-a2ae5b2383a5",default_version:"0.9",supported_versions:["0.9","1.1"]},{id:"8cd063cc-ed00-41d9-ae81-aa194b9d580a",default_version:"1.1",supported_versions:["0.9","1.1"]}]},S=["3f2e766c-482b-40db-8370-10514bd41218","231f8701-f249-45a8-9a06-5362e9f0d99e","2ca0a10a-1284-492f-a272-e1608d5cd54a","72e7a78f-d045-4576-b825-4628cf9b1f07","c47ea753-0c38-4a20-a0c1-b12752c86a50"],g=b.isEmptyString,L=b.isEmptyObject;function q(e,n){switch(e){case"dpaUriV10":return function(e){if(-1!==S.indexOf(e.srcInitiatorId)){if(!e.dpaData||!Object.keys(e.dpaData).length)return!1;if(!e.dpaData.dpaUri)return!1}return!0}(n);case"transactionAmountV10":return function(e){var n=e.threeDsPreference;if(n&&"ONBEHALF"===n)return!L(e.transactionAmount);return!0}(n);case"transactionCurrencyCodeV10":return function(e){return null===e.transactionAmount||void 0===e.transactionAmount||!g(e.transactionCurrencyCode)}(n);case"CheckoutV10":return function(e){return e.srcDigitalCardId||e.encryptedCard}(n);case"dpaUriV11":return function(e){return!!g(e.dpaLogoUri)||!g(e.dpaUri)}(n);case"dpaLogoUriV11":return function(e){return!!g(e.dpaUri)||!g(e.dpaLogoUri)}(n);case"threeDsInputDataV11":return function(e){return"ONBEHALF"!==e.threeDsPreference||!g(e.threeDsInputData)}(n);case"merchantCategoryCodeCodeV11":return function(e){return"ONBEHALF"!==e.threeDsPreference||!g(e.merchantCategoryCode)}(n);case"merchantCountryCodeV11":return function(e){return"ONBEHALF"!==e.threeDsPreference||!g(e.merchantCountryCode)}(n);default:return!0}}var V,U,M,F,J,G,B,K=r.VERSION,j=h.SDKErrorCodes,H={sdkVersion:"1.0.0",baseVersion:"0.9",versions:[{version:"0.9",date:"",config:{init:{request:{type:"object",num:4,qualifier:"required",qualifyFn:"dpaUriV10",properties:[{name:"srciTransactionId",type:"string",qualifier:"required",errorReason:"SRCI_TXN_ID_MISSING"},{name:"srcInitiatorId",type:"string",qualifier:"required",errorReason:"SRCI_ID_MISSING"},{name:"dpaData",type:"object",qualifier:"optional",properties:[{name:"dpaPresentationName",type:"string",qualifier:"required"}]},{name:"dpaTransactionOptions",type:"object",qualifier:"optional",properties:[{name:"transactionAmount",type:"object",qualifier:"conditional",qualifyFn:"transactionAmountV10",properties:[{name:"transactionAmount",qualifier:"required"},{name:"transactionCurrencyCode",type:"string",qualifier:"conditional",qualifyFn:"transactionCurrencyCodeV10"}]}]}]},response:null},isRecognized:{request:null,response:{type:"object",num:2,qualifier:"required",properties:["recognized","idTokens"],filterFn:["IsRecognizedV10"],filters:null},api:{request:{}}},identityLookup:{request:{type:"object",num:2,qualifier:"required",properties:[{name:"identityValue",type:"string",qualifier:"required",errorReason:"CONSUMER_ID_MISSING"},{name:"type",type:"string",qualifier:"required"}]},response:{type:"object",num:1,qualifier:"required",properties:["consumerPresent","supportedValidationChannels"],filterFn:null,filters:null}},getSrcProfile:{request:{type:"array",name:"idTokens",num:1,qualifier:"required",properties:null,errorReason:"AUTH_INVALID"},response:{type:"object",num:1,qualifier:"required",properties:["profiles","srcCorrelationId"],filterFn:["GetSrcProfileV10"],filters:null}},initiateIdentityValidation:{request:null,response:{type:"object",num:1,qualifier:"required",properties:["maskedValidationChannel","validationMessage","supportedValidationChannels"],filterFn:null,filters:null}},completeIdentityValidation:{request:{type:"string",name:"validationData",num:1,qualifier:"required",properties:null},response:{type:"object",num:1,qualifier:"required",properties:["idToken"],filterFn:null,filters:null}},checkout:{request:{type:"object",qualifier:"required",qualifyFn:"CheckoutV10",num:5,properties:[{name:"srcDigitalCardId",type:"string",qualifier:"conditional"},{name:"encryptedCard",type:"string",qualifier:"conditional"},{name:"idToken",type:"string",qualifier:"optional"}]},response:{type:"object",num:1,properties:["dcfActionCode","idToken","checkoutResponseSignature","checkoutResponse","unbindAppInstance"],qualifier:"required",filterFn:["checkoutResponseV10","checkoutResponseV11"]}},unbindAppInstance:{request:{type:"array",name:"idTokens",num:1,qualifier:"required",properties:null},response:{type:"object",num:1,qualifier:"required",filterFn:null,filters:null}}}},{version:"1.1",date:"",config:{init:{request:{type:"object",num:4,qualifier:"required",properties:[{name:"srcInitiatorId",type:"string",qualifier:"required",errorReason:"SRCI_ID_MISSING"},{name:"dpaData",type:"object",qualifier:"required",properties:[{name:"dpaName",type:"string",qualifier:"required"}]},{name:"dpaTransactionOptions",type:"object",qualifier:"optional",properties:[{name:"transactionAmount",type:"object",qualifier:"conditional",qualifyFn:"transactionAmountV10",properties:[{name:"transactionAmount",type:"number",qualifier:"required"},{name:"transactionCurrencyCode",type:"currency",qualifier:"required"}]},{name:"dpaBillingPreference",type:"string",qualifier:"optional",enums:["ALL","POSTAL_COUNTRY","NONE"]},{name:"dpaShippingPreference",type:"string",qualifier:"optional",enums:["ALL","POSTAL_COUNTRY","NONE"]},{name:"threeDsPreference",type:"string",qualifier:"required",enums:["NONE","SELF","ONBEHALF"]},{name:"threeDsInputData",type:"object",qualifier:"conditional",qualifyFn:"threeDsInputDataV11"},{name:"merchantCategoryCode",type:"string",qualifier:"conditional",qualifyFn:"merchantCategoryCodeCodeV11"},{name:"merchantCountryCode",type:"string",qualifier:"conditional",qualifyFn:"merchantCountryCodeV11"}]}]},response:null},isRecognized:{request:null,response:{type:"object",num:2,qualifier:"required",properties:["recognized","idTokens"],filterFn:["IsRecognizedV10"],filters:null},api:{request:{},response:{qualifyFn:"replaceIdToken"}}},identityLookup:{request:{type:"object",num:1,qualifier:"required",properties:[{name:"identityValue",type:"string",qualifier:"required",errorReason:"CONSUMER_ID_MISSING"},{name:"identityType",type:"string",qualifier:"required",enums:["EMAIL_ADDRESS","MOBILE_PHONE_NUMBER","CUSTOM_IDENTIFIER"]}]},response:{type:"object",num:1,properties:["consumerPresent","supportedValidationChannels"]}},getSrcProfile:{request:{type:"array",name:"idTokens",num:1,qualifier:"optional",properties:null,errorReason:"AUTH_INVALID"},response:{type:"object",num:1,qualifier:"required",properties:["profiles","srcCorrelationId"],filterFn:["GetSrcProfileV10"],modifyFn:["SrcProfile11"],filters:null}},initiateIdentityValidation:{request:{type:"string",name:"requestedValidationChannelId",num:1,qualifier:"optional",errorReason:"ID_INVALID"},response:{type:"object",num:1,qualifier:"required",properties:["maskedValidationChannel","validationMessage","supportedValidationChannels"],filterFn:null,filters:null}},completeIdentityValidation:{request:{type:"string",name:"validationData",num:1,qualifier:"required",properties:null},response:{type:"object",num:1,qualifier:"required",properties:["idToken"],filterFn:null,filters:null}},checkout:{request:{type:"object",qualifier:"required",qualifyFn:"CheckoutV10",num:5,properties:[{name:"srcDigitalCardId",type:"string",qualifier:"conditional"},{name:"encryptedCard",type:"string",qualifier:"conditional"},{name:"idToken",type:"string",qualifier:"optional"},{name:"dpaData",type:"object",qualifier:"optional",properties:[{name:"dpaName",type:"string",qualifier:"required"}]},{name:"dpaTransactionOptions",type:"object",qualifier:"optional",properties:[{name:"transactionAmount",type:"object",qualifier:"conditional",qualifyFn:"transactionAmountV10",properties:[{name:"transactionAmount",type:"number",qualifier:"required"},{name:"transactionCurrencyCode",type:"currency",qualifier:"required "}]},{name:"dpaBillingPreference",type:"string",qualifier:"optional",enums:["ALL","POSTAL_COUNTRY","NONE"]},{name:"dpaShippingPreference",type:"string",qualifier:"optional",enums:["ALL","POSTAL_COUNTRY","NONE"]},{name:"threeDsPreference",type:"string",qualifier:"required",enums:["NONE","SELF","ONBEHALF"]},{name:"threeDsInputData",type:"object",qualifier:"conditional",qualifyFn:"threeDsInputDataV11"},{name:"merchantCategoryCode",type:"string",qualifier:"conditional",qualifyFn:"merchantCategoryCodeCodeV11"},{name:"merchantCountryCode",type:"string",qualifier:"conditional",qualifyFn:"merchantCountryCodeV11"}]},{name:"payloadTypeIndicatorPayload",type:"string",qualifier:"optional",enums:["FULL","PAYMENT"]},{name:"payloadTypeIndicatorCheckout",type:"string",qualifier:"optional",enums:["SUMMARY","FULL","PAYMENT","NON_PAYMENT"]},{name:"srciActionCode",type:"string",qualifier:"conditional",enums:["NEW_USER","AUTH_FAILED","AUTH_SKIPPED"]},{name:"windowRef",type:"string",qualifier:"required"}]},response:{type:"object",num:1,qualifier:"required",properties:["dcfActionCode","idToken","checkoutResponse","unbindAppInstance"],filterFn:["checkoutResponseV10","checkoutResponseV11"]}},unbindAppInstance:{request:{type:"array",name:"idTokens",num:1,qualifier:"required",properties:null},response:{type:"object",num:1,qualifier:"required"}}}}]};U=V||(V={}),M=b.isEmpty,J="",G=F=null,B=function(){function t(e,n){G=F=null,"invalid_version"!==(J=t.requestVersion(e,n))&&(F=H,window.amexSrcInstance.setItem(K,J),G=F.versions.find(function(e){return e.version===J}))}return t.buildResponse=function(e,n){var t={};if(G){var r=G.config[e].response,a=r.filters,s=r.filterFn,o=r.properties,i=r.modifyFn;o&&o.forEach(function(e){null===n[e]&&void 0===n[e]||(t[e]=n[e])}),s&&s.forEach(function(e){t=function(e,n){switch(e){case"IsRecognizedV10":return function(e){return e&&!1===e.recognized&&delete e.idTokens,e}(n);case"GetSrcProfileV10":return function(e){return e&&e.profiles&&0!=e.profiles.length||delete e.srcCorrelationId,e}(n);case"checkoutResponseV10":return function(e){return e&&e.dcfActionCode&&"COMPLETE"!==e.dcfActionCode&&(delete e.checkoutResponse,delete e.checkoutResponseSignature),e}(n);case"checkoutResponseV11":return function(e){return e&&!1===e.unbindAppInstance&&delete e.idToken,e}(n);default:return n}}(e,t)}),a&&a.forEach(function(e){delete t[e]}),i&&i.forEach(function(e){t=function(e,n){switch(e){case"SrcProfile11":return function(n){try{return n&&n.profiles&&n.profiles.forEach(function(e){e.authorization=e.idToken,delete e.idToken}),n}catch(e){return n}}(n);default:return n}}(e,t)})}return t},t.validateRequest=function(e,n){var t={isError:!1,error:{},field:""};if(G){var r=G.config[e].request;if(r){if(!("required"!==r.type&&M(n)||this.validateType(n,r.type)))return t.isError=!0,t.error=Object.assign.apply(Object,[{}].concat(j.standardErrorCodes.INVALID_PARAMETER)),t;if(r.qualifyFn)if(!q(""+r.qualifyFn,n))return t.isError=!0,t.error=Object.assign.apply(Object,[{}].concat(j.standardErrorCodes.INVALID_PARAMETER)),t;if(r.properties&&0<r.properties.length){var a=this.validateFields(r.properties,n);if(a.isError){var s=a.error;t.isError=!0,s?t.error=Object.assign.apply(Object,[{}].concat(j[e][s])):(t.error=Object.assign.apply(Object,[{}].concat(j.standardErrorCodes.INVALID_PARAMETER)),t.error.message+=" : "+a.field)}}}}else t.isError=!0,t.error=Object.assign.apply(Object,[{}].concat(j.init.VERSION_MISSING));return t},t.validateFields=function(e,n){for(var t={isError:!1,error:{},field:""},r=this.getRequiredFields(e),a=0;a<r.length;a++){if(this.isEmptyField(n[r[a].name])||!this.validateField(n[r[a].name],r[a]))return console.log("Error found in field",r[a].name),t.isError=!0,t.error=r[a].errorReason,t.field=r[a].name,t;if(r[a].properties){var s=this.validateFields(r[a].properties,n[r[a].name]);if(s.isError)return s}}var o=this.getConditionalFields(e);for(a=0;a<o.length;a++){if(!q(""+o[a].qualifyFn,n))return console.log("Error found in field",o[a].name),t.isError=!0,t.error=o[a].errorReason,t.field=o[a].name,t;if(!this.isEmptyField(n[o[a].name])){if(!this.validateField(n[o[a].name],o[a]))return t.isError=!0,t.error=o[a].errorReason,t.field=o[a].name,t;if(o[a].properties){var i=this.validateFields(o[a].properties,n[o[a].name]);if(i.isError)return i}}}var c=this.getOptionalFields(e);for(a=0;a<c.length;a++)if(!this.isEmptyField(n[c[a].name])){if(!this.validateField(n[c[a].name],c[a]))return console.log("Error found in field",c[a].name),t.isError=!0,t.error=c[a].errorReason,t.field=c[a].name,t;if(c[a].properties){var d=this.validateFields(c[a].properties,n[c[a].name]);if(d.isError)return d}}return t},t.getRequiredFields=function(e){return e.filter(function(e){return"required"===e.qualifier})},t.getOptionalFields=function(e){return e.filter(function(e){return"optional"===e.qualifier})},t.getConditionalFields=function(e){return e.filter(function(e){return"conditional"===e.qualifier})},t.isEmptyField=function(e){return null==e||void 0===e||""===e},t.validateField=function(e,n){return!!this.validateType(e,n.type)&&!(n.enums&&!this.validateEnum(e,n.enums))},t.validateEnum=function(n,e){return!e||e.find(function(e){return e===n})},t.validateType=function(e,n){switch(n){case"string":return"string"==typeof e;case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"array":return Array.isArray(e)&&0<e.length;case"currency":return 3===e.length;default:return!0}},t.requestVersion=function(e,n){var t=n.default_version,r=n.supported_versions;return e?Number(e)>=Number(t)&&-1!==r.indexOf(e)?e:"invalid_version":t},t}(),U.Versioning=B;var Y=r.SDK_API_NAME,z=r.SESSION_ID,X=b.initalizeCsrtEvent,Q=e.SplunkEventName,W=b.updateCsrtEvent,Z=e.CsrtFieldName,ee=b.getTimeStamp,ne=l.Options,te=l.Service,re=h.SDKErrorCodes,ae=r.ACCESS_TOKEN,se=r.API_TIMEOUT,oe=r.BASE_IDENTITY_URL,ie=r.CORRELATION_ID,ce=r.INITIATOR_ID,de=r.JSON_CONTENT_TYPE,ue=r.SRC_TRANSACTION_ID,pe=r.TRANSACTION_ID,le=re.completeIdentityValidation,Ie=re.standardErrorCodes;!function(e){var n;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var t=window.Cookies,r=window.Cookies=e();r.noConflict=function(){return window.Cookies=t,r}}}(function(){function i(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var r in t)n[r]=t[r]}return n}function d(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(c){function o(){}function t(e,n,t){if("undefined"!=typeof document){"number"==typeof(t=i({path:"/"},o.defaults,t)).expires&&(t.expires=new Date(1*new Date+864e5*t.expires)),t.expires=t.expires?t.expires.toUTCString():"";try{var r=JSON.stringify(n);/^[\{\[]/.test(r)&&(n=r)}catch(e){}n=c.write?c.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var s in t)t[s]&&(a+="; "+s,!0!==t[s]&&(a+="="+t[s].split(";")[0]));return document.cookie=e+"="+n+a}}function n(e,n){if("undefined"!=typeof document){for(var t={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),o=s.slice(1).join("=");n||'"'!==o.charAt(0)||(o=o.slice(1,-1));try{var i=d(s[0]);if(o=(c.read||c)(o,i)||d(o),n)try{o=JSON.parse(o)}catch(e){}if(t[i]=o,e===i)break}catch(e){}}return e?t[e]:t}}return o.set=t,o.get=function(e){return n(e,!1)},o.getJSON=function(e){return n(e,!0)},o.remove=function(e,n){t(e,"",i(n,{expires:-1}))},o.defaults={},o.withConverter=e,o}(function(){})});var fe=function(s,o,i,c){return new(i||(i=Promise))(function(e,n){function t(e){try{a(c.next(e))}catch(e){n(e)}}function r(e){try{a(c.throw(e))}catch(e){n(e)}}function a(n){n.done?e(n.value):new i(function(e){e(n.value)}).then(t,r)}a((c=c.apply(s,o||[])).next())})},me=function(t,r){var a,s,o,e,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,s=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){i.label=n[1];break}if(6===n[0]&&i.label<o[1]){i.label=o[1],o=n;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(n);break}o[2]&&i.ops.pop(),i.trys.pop();continue}n=r.call(t,i)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}},Se=window.Cookies||"",ge="AMEX_REFRESHTOKENS",_e=function(){function e(){}return e.getInstance=function(){return this.indexObj||(this.indexObj=new e),this.indexObj},e.prototype.getAllRefreshTokenFromCookie=function(a){return fe(this,void 0,void 0,function(){var n,t,r;return me(this,function(e){return n=Se.get(ge)||"[]",t=JSON.parse(n)||[],r=[],0<t.length&&t.map(function(e){r.push(e.data)}),a(r),[2]})})},e.prototype.getAllDataFromCookie=function(){var e=this;return new Promise(function(n){return fe(e,void 0,void 0,function(){return me(this,function(e){return n(JSON.parse(Se.get(ge)||"[]")||[]),[2]})})})},e.prototype.clearAllRefreshTokens=function(){return fe(this,void 0,void 0,function(){return me(this,function(e){return Se.remove(ge),[2]})})},e.prototype.addSafariCookie=function(){this.setCookie("SAFARI","test-cookie")},e.prototype.addRefreshToken=function(c){var d=this;return new Promise(function(a,e){if(c.length<=10||3!==c.split(".").length)e("Invalid Refresh Token!");else{var i={data:c,uid:(new Date).getTime().toString()+Math.random()};d.getAllDataFromCookie().then(function(s){if(s&&0!==s.length&&"error"!==s){var e=null;try{var t=JSON.parse(atob(c.split(".")[1])).sub;e=s.find(function(e){var n=e.data;return JSON.parse(atob(n.split(".")[1])).sub===t})}catch(e){return"invalid refresh token!!!"}if(e){var n=s.indexOf(e);s.splice(n,1)}s.push(i);var o=function(){3950<JSON.stringify(s).length?function(){var r=new Map,a=new Map;s.map(function(e,n){if(n!==s.length-1){var t=JSON.parse(atob(e.data.split(".")[1]));t.ext_remember_me?a.set(t.exp,n):r.set(t.exp,n)}});var e=0;if(r.size){var n=Array.from(r.keys()),t=Math.min.apply(Math,n);e=r.get(t)}else n=Array.from(a.keys()),t=Math.min.apply(Math,n),e=a.get(t);s.splice(e,1),o()}():d.setCookie(ge,JSON.stringify(s))};o(),a()}else{var r=[];r.push(i),d.setCookie(ge,JSON.stringify(r)),a()}})}})},e.prototype.addRefreshTokenArray=function(r){var a=this;return new Promise(function(e,n){var t=r.map(function(e){if(!(e.length<=10||3!==e.split(".").length))return e}).map(function(e){return{data:e,uid:(new Date).getTime().toString()+Math.random()}});a.setCookie(ge,JSON.stringify(t)),e()})},e.prototype.notSupportSameSite=function(){var e=navigator.userAgent;return!!(e.includes("Macintosh; Intel Mac OS X 10_14")&&e.includes("Version/")&&e.includes("Safari"))||(!(!e.includes("CPU iPhone OS 12")&&!e.includes("iPad; CPU OS 12"))||!(!e.includes("Chrome/5")&&!e.includes("Chrome/6")))},e.prototype.setCookie=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.notSupportSameSite()?Se.set.apply(Se,e.concat([{expires:300}])):Se.set.apply(Se,e.concat([{expires:300,sameSite:"none",secure:!0}]))},e}();_e.getInstance();var Te=function(s,o,i,c){return new(i||(i=Promise))(function(e,n){function t(e){try{a(c.next(e))}catch(e){n(e)}}function r(e){try{a(c.throw(e))}catch(e){n(e)}}function a(n){n.done?e(n.value):new i(function(e){e(n.value)}).then(t,r)}a((c=c.apply(s,o||[])).next())})},Ee=function(t,r){var a,s,o,e,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,s=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){i.label=n[1];break}if(6===n[0]&&i.label<o[1]){i.label=o[1],o=n;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(n);break}o[2]&&i.ops.pop(),i.trys.pop();continue}n=r.call(t,i)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}},he=r.AMEX_UNKOWN_RT,Ce=function(){function e(){}return e.getInstance=function(){return this.obj||(this.obj=new e),this.obj},e.prototype.clearAllUnknownTokens=function(){return Te(this,void 0,void 0,function(){return Ee(this,function(e){return[2,new Promise(function(e){localStorage.clear(),e()})]})})},e.prototype.addToken=function(n){var t=this;try{return new Promise(function(e){t.getTokens().then(function(r){var a=JSON.parse(atob(n.split(".")[1]));r.forEach(function(e){var n=JSON.parse(atob(e.split(".")[1]));if(a.sub===n.sub){var t=r.indexOf(e);r.splice(t,1)}}),r.push(n),localStorage.setItem(he,JSON.stringify(r)),e()})})}catch(e){}},e.prototype.getTokens=function(){var e=this;return new Promise(function(n){return Te(e,void 0,void 0,function(){return Ee(this,function(e){try{n(JSON.parse(localStorage.getItem(he)||"[]")||[])}catch(e){n([])}return[2]})})})},e.prototype.getTokensWithoutPromise=function(){try{return JSON.parse(localStorage.getItem(he)||"[]")}catch(e){return[]}},e.prototype.deleteToken=function(r){var e=this;try{return new Promise(function(n){var t=[];try{e.getTokens().then(function(e){e.forEach(function(e){var n=e&&JSON.parse(atob(e.split(".")[1]));n&&r!==n.sub&&t.push(e)}),localStorage.setItem(he,JSON.stringify(t)),n()})}catch(e){console.log("Error processing tokens")}})}catch(e){}},e}();Ce.getInstance();var Re=r.ID_TOKENS,ve=r.SDK_API_NAME,Ae=r.DCF_PATH,Ne=b.getNavigatorLanguage,Oe=r.THREEDS_TRANS_ID,ye=r.IGNORE_PAYLOAD,we=r.PAYLOAD_TRANS_ID,De=b.initalizeCsrtEvent,ke=e.SplunkEventName,be=b.updateCsrtEvent,Pe=e.CsrtFieldName,xe=b.getTimeStamp,Le=b.storeHeader,qe=h.SDKErrorCodes.standardErrorCodes,Ve=l.Options,Ue=l.Service,Me=r.ACCESS_TOKEN,Fe=r.API_TIMEOUT,Je=r.BASE_CHECKOUT_URL,Ge=r.CORRELATION_ID,Be=r.DPA_DATA,Ke=r.DPA_TRANSACTION_DATA,je=r.INITIATOR_ID,He=r.JSON_CONTENT_TYPE,Ye=r.SRC_PROFILE,ze=r.SRC_TRANSACTION_ID,Xe=r.TRANSACTION_ID;function Qe(s){return new Promise(function(I,f){var m={resolveIndex:s.resolveIndex,response:{}};De(ke.Checkout);var S=m.response;try{var g=s.request,e=V.Versioning.validateRequest(ve.CHECKOUT,g);if(e.isError)return S.reason=e.error.reason,S.message=e.error.message,void f(m);var n=_e.getInstance();if(g.dpaData&&window.amexSrcInstance.setItem(Be,JSON.stringify(g.dpaData)),g.dpaTransactionOptions){var t=g.dpaTransactionOptions,r=t.paymentOptions;if(r&&null!==r.dynamicDataType&&void 0!==r.dynamicDataType){var a=[];Array.isArray(r.dynamicDataType)||(a.push(r.dynamicDataType),r.dynamicDataType=a)}t.paymentOptions=r,window.amexSrcInstance.setItem(Ke,JSON.stringify(t))}g.srciTransactionId&&window.amexSrcInstance.setItem(Xe,g.srciTransactionId);var _=[];be(Pe.encrypted_card,g.encryptedCard,ke.Checkout);n.getAllRefreshTokenFromCookie(function(e){e&&"error"!==e&&0!==e.length?e.map(function(e){_.push(e)}):_=[],function(){var e=g.srciTransactionId,n={"Accept-Language":"*","Content-Type":He,RequestTimestamp:xe(),SrcInitiatorId:window.amexSrcInstance.getItem(je),SrcsTransactionId:window.amexSrcInstance.getItem(ze)};g.invitation_id&&(n.AccessId=g.invitation_id),e&&(n.SrciTransactionId=e);var t=window.amexSrcInstance.getItem(Ge),r=window.amexSrcInstance.getItem(Me);r&&(n.AccessToken=r,t&&(n.SrcCorrelationId=t));var a=window.amexSrcInstance.getItem(Be)||"",s=window.amexSrcInstance.getItem(Ke)||"",o={cardTransactionRequest:{refreshTokens:_},encryptedCardObject:g.encryptedCard,browserLocale:Ne()},i={url:Je+"/card/transactions/",crossDomain:!0,dataType:"json",type:"POST"};a&&(o.cardTransactionRequest.dpaData=JSON.parse(a)),s&&(o.cardTransactionRequest.dpaTransactionOptions=JSON.parse(s));var c=g.payloadTypeIndicatorCheckout,d=g.payloadTypeIndicatorPayload;c&&(o.payloadTypeIndicatorCheckout=c),d&&(o.payloadTypeIndicatorPayload=d);var u=new Ue,p=new Ve(i.url,i.type,JSON.stringify(o),n,Fe,!0),l=function(e,n){n&&(Le(n,Ge),Le(n,Me));var t=e.responseJSON||e;if(t&&0===t.status)return S.reason=qe.REQUEST_TIMEOUT.reason,S.message=qe.REQUEST_TIMEOUT.message,void f(m);if(t){var r=t.status.code;if("SRC_041"===r||"SRC_055"===r||"SRC_043"===r||"SRC_009"===r||"SRC_058"===r||"SRC_059"===r)return S.srcProfile=t,S.srcProfile.refreshTokens=_,S.nextStep=Ae.ERROR,S.status=t.status,void I(m);if("SRC_003"!==r)return S.reason=qe.SERVER_ERROR.reason,S.message=qe.SERVER_ERROR.message,void f(m);S.srcProfile=t,S.srcProfile.refreshTokens=_,S.nextStep=Ae.ADD_CARD,S.status=t.status,I(m)}else S.reason=qe.SERVER_ERROR.reason,S.message=qe.SERVER_ERROR.message;f(m)};u.request(p,function(e,n,t){e.status.code&&"0000"===e.status.code?We(e,t,g,_).then(function(e){S.nextStep=e.nextStep,S.srcProfile=e.srcProfile,I(m)}).catch(function(e){S.message=e.message,f(m)}):l(e,t)},function(e,n){l(e)})}()})}catch(e){S.message=e.message,f(m)}})}var We=function(m,S,g,e){return new Promise(function(e,n){try{Le(S,Ge),Le(S,Me);var t=g.card,r={};if(m&&m.nextStep){if(m.refreshToken){var a=Ce.getInstance(),s=JSON.parse(atob(m.refreshToken.split(".")[1]));a.deleteToken(s.sub);var o=JSON.parse(window.amexSrcInstance.getItem(Re)||"[]");if(s.ext_remember_me&&0<o.length)for(var i=0;i<o.length;i++){var c=JSON.parse(atob(o[i].split(".")[1]));if(s.sub===c.email){m.idToken=o[i];break}}}if(window.amexSrcInstance.setItem(ye,!!m.payloadThreeDSServerTransId),m.stepUpThreeDSServerTransId||m.payloadThreeDSServerTransId){var d=m.stepUpThreeDSServerTransId||m.payloadThreeDSServerTransId;m.threeDSServerTransID=d,window.amexSrcInstance.setItem(Oe,d),m.payloadThreeDSServerTransId&&window.amexSrcInstance.setItem(we,m.payloadThreeDSServerTransId)}var u="prop";if(m.responseMetaData)u="001"!==m.responseMetaData.issuerCode?"/issuer":"/prop";if("sendOTP"===m.nextStep)r.nextStep=u+Ae.SEND_OTP,(f=m).accessToken=window.amexSrcInstance.getItem(Me)||"",r.srcProfile=f,e(r);else if("review"===m.nextStep){r.nextStep=u+Ae.REVIEW,(f=m).maskedConsumer=f.consumer,f.accessToken=window.amexSrcInstance.getItem(Me);var p=f.consumerId,l=JSON.parse(window.amexSrcInstance.getItem(Ye)||"{}");if(l&&0<l.length){var I=l.find(function(e){return e.consumerId===p});I&&I.refreshToken&&(f.refreshToken=I.refreshToken)}r.srcProfile=f,e(r)}else if("cid"===m.nextStep){r.nextStep=u+Ae.CID,(f=m).accessToken=window.amexSrcInstance.getItem(Me)||"",f.card=t,r.srcProfile=f,e(r)}else if("billing"===m.nextStep){r.nextStep=u+Ae.BILLING,(f=m).accessToken=window.amexSrcInstance.getItem(Me)||"",f.card=t,r.srcProfile=f,r.srcProfile.encryptedCardObject=g.encryptedCard,e(r)}else if("skFlow"===m.nextStep){var f;(f=m).srcCorrelationId=window.amexSrcInstance.getItem(Ge),f.srcsTransactionId=window.amexSrcInstance.getItem(ze),f.srcInitiatorId=window.amexSrcInstance.getItem(je),f.accessToken=window.amexSrcInstance.getItem(Me),r.srcProfile=f,r.nextStep=Ae.SAFEKEY,e(r)}else e(r)}else e(r)}catch(e){n(e)}})},Ze=b.checkArrayOfStrings,$e=r.SDK_API_NAME,en=e.SplunkEventName,nn=e.CsrtFieldName,tn=b.getTimeStamp,rn=b.storeHeader,an=b.initalizeCsrtEvent,sn=b.updateCsrtEvent,on=h.SDKErrorCodes,cn=l.Options,dn=l.Service,un=_e.getInstance(),pn="",ln=r.ACCESS_TOKEN,In=r.API_TIMEOUT,fn=r.BASE_PROFILE_URL,mn=r.CORRELATION_ID,Sn=r.DPA_DATA,gn=r.DPA_TRANSACTION_DATA,_n=r.ID_TOKENS,Tn=r.INITIATOR_ID,En=r.JSON_CONTENT_TYPE,hn=r.MAT_NONMAT,Cn=r.MATCHED,Rn=r.NON_MATCHED,vn=r.SRC_PROFILE,An=r.SRC_TRANSACTION_ID,Nn=r.TRANSACTION_ID,On=r.LOG_ID_TOKEN,yn=on.getSrcProfile,wn=on.standardErrorCodes;var Dn=function(s,e){var r={};return new Promise(function(n,t){try{var a={matchedList:[],notMatchedList:[],toBeUpdatedRefreshTokens:[]};e.map(function(e){var t=JSON.parse(atob(e.split(".")[1])),r=!1;s.map(function(e){var n=JSON.parse(atob(e.split(".")[1]));r||n.sub===t.email&&(a.toBeUpdatedRefreshTokens.push(e),function(n){var e=window.amexSrcInstance.getItem(vn);if(!e)return!1;var t=JSON.parse(e).find(function(e){return e.consumerId===n});return t&&t.maskedCards&&1<=t.maskedCards.length}(t.email)&&(r=!0))}),r?a.matchedList.push(e.concat("||matched")):a.notMatchedList.push(e.concat("||unmatched"))}),kn(e,s,a).then(function(e){r.srcProfile=e.srcProfile,n(r)}).catch(function(e){r.reason=e.reason,r.message=e.message,t(r)})}catch(e){r.message=e.message,t(r)}})},kn=function(p,e,l){var I={};return new Promise(function(r,a){try{var e=window.amexSrcInstance.getItem(mn),n=window.amexSrcInstance.getItem(ln),t=window.amexSrcInstance.getItem(Tn),s=window.amexSrcInstance.getItem(Nn),o=window.amexSrcInstance.getItem(An),i={"Accept-Language":"*","Content-Type":En,RequestTimestamp:tn(),SrcInitiatorId:t||null,SrcsTransactionId:o||null};s&&(i.SrciTransactionId=s),n&&(i.AccessToken=n,e&&(i.SrcCorrelationId=e));var c={idTokens:[]};if(0<l.toBeUpdatedRefreshTokens.length&&(c.toBeUpdatedRefreshTokens=l.toBeUpdatedRefreshTokens),e&&n||(c.dpaData=JSON.parse(window.amexSrcInstance.getItem(Sn)||"{}"),c.dpaTransactionOptions=JSON.parse(window.amexSrcInstance.getItem(gn)||"{}")),sn(nn.matched_rt_cnt,String(l.matchedList.length),en.GetSrcProfile),sn(nn.non_matched_rt_cnt,String(l.notMatchedList.length),en.GetSrcProfile),l.matchedList.length===p.length){pn=Cn,c.idTokens=l.matchedList;var d=Ln(c.idTokens);d&&0!==d.length?(I.srcProfile=Vn(d,c.idTokens),r(I)):(I.reason=wn.SERVER_ERROR.reason,I.message=wn.SERVER_ERROR.message,a(I));var u=new cn(fn+"/transactions","POST",JSON.stringify(c),i,In,!0);(new dn).request(u,function(e){0<l.toBeUpdatedRefreshTokens.length&&e.srcProfile.map(function(e){return e.refreshToken&&un.addRefreshToken(e.refreshToken)})},function(e){})}else if(l.notMatchedList.length===p.length)bn(p,l).then(function(e){I.srcProfile=e.srcProfile,r(I)}).catch(function(e){I.reason=e.reason,I.message=e.message,a(I)});else{pn=hn,c.idTokens=l.matchedList.concat(l.notMatchedList);u=new cn(fn+"/transactions","POST",JSON.stringify(c),i,In,!0);(new dn).request(u,function(e,n,t){!e||e.status&&e.status.code&&"0000"!==e.status.code?Pn(e):xn(e,c.idTokens,t).then(function(e){I.srcProfile=e.srcProfile,r(I)}).catch(function(e){e?(I.reason=e.reason,I.message=e.message):(I.reason=wn.SERVER_ERROR.reason,I.message=wn.SERVER_ERROR.message),a(I)})},function(e){pn=Cn,xn(e,l.matchedList).then(function(e){I.srcProfile=e.srcProfile,r(I)})})}}catch(e){I.message=e.message,a(I)}})},bn=function(p,l){var I={};return new Promise(function(r,a){try{pn=Rn;var e=window.amexSrcInstance.getItem(mn),n=window.amexSrcInstance.getItem(ln),t=window.amexSrcInstance.getItem(Tn),s=window.amexSrcInstance.getItem(Nn),o=window.amexSrcInstance.getItem(An),i={"Accept-Language":"*","Content-Type":En,RequestTimestamp:tn(),SrcInitiatorId:t||null,SrcsTransactionId:o||null};s&&(i.SrciTransactionId=s),n&&(i.AccessToken=n,e&&(i.SrcCorrelationId=e));var c={idTokens:[]},d={notMatchedList:[]};p.map(function(e){return d.notMatchedList.push(e.concat("||unmatched")),e}),c.idTokens=d.notMatchedList,sn(nn.matched_rt_cnt,"0",en.GetSrcProfile),sn(nn.non_matched_rt_cnt,String(d.notMatchedList.length),en.GetSrcProfile),l&&l.toBeUpdatedRefreshTokens&&(c.toBeUpdatedRefreshTokens=l.toBeUpdatedRefreshTokens),e&&n||(c.dpaData=JSON.parse(window.amexSrcInstance.getItem(Sn)||"{}"),c.dpaTransactionOptions=JSON.parse(window.amexSrcInstance.getItem(gn)||"{}"));var u=new cn(fn+"/transactions","POST",JSON.stringify(c),i,9e3,!1);(new dn).request(u,function(e,n,t){e.status&&"0000"!==e.status.code?Pn(e).catch(function(e){a(e)}):xn(e,c.idTokens,t).then(function(e){I.srcProfile=e.srcProfile,r(I)}).catch(function(e){e?(I.reason=e.reason,I.message=e.message):(I.reason=wn.SERVER_ERROR.reason,I.message=wn.SERVER_ERROR.message),a(I)})},function(e,n,t){Pn(e).catch(function(e){a(e)})})}catch(e){I.message=e.message,a(I)}})},Pn=function(e){var r=e.responseJSON||e;return new Promise(function(e,n){var t={};if(r&&0===r.status)return t.reason=wn.REQUEST_TIMEOUT.reason,t.message=wn.REQUEST_TIMEOUT.message,void n(t);r&&"SRC_010"===r.status.code?(t.reason=yn.AUTH_INVALID.reason,t.message=yn.AUTH_INVALID.message):(t.reason=wn.SERVER_ERROR.reason,t.message=wn.SERVER_ERROR.message),n(t)})},xn=function(a,s,o){return new Promise(function(e,n){var t={};if(a.srcProfile&&0===a.srcProfile.length)return t.message=yn.EMPTY_PROFILES.message,t.reason=yn.EMPTY_PROFILES.reason,void n(t);if(a){o&&qn(a,o);var r=Ln(s,a);t.srcProfile=Vn(r,s),e(t)}else e(t)})},Ln=function(e,n){var t=[],r=window.amexSrcInstance.getItem(vn);if(pn===Cn)t=(t=r&&JSON.parse(r)).filter(function(r){if(r.refreshToken)return e.some(function(e){var n=JSON.parse(atob(r.refreshToken.split(".")[1])),t=JSON.parse(atob(e.split(".")[1]));return n.sub===t.email})});else if(pn===Rn&&n)t=n.srcProfile,window.amexSrcInstance.setItem(vn,JSON.stringify(t));else if(pn===hn&&n){t=(t=r&&JSON.parse(r)).filter(function(r){if(r.refreshToken)return e.some(function(e){var n=JSON.parse(atob(r.refreshToken.split(".")[1])),t=JSON.parse(atob(e.split(".")[1]));return n.sub===t.email})});var a=n.srcProfile.filter(function(e){return e.maskedCards});t=t.concat(a),window.amexSrcInstance.setItem(vn,JSON.stringify(t))}return t},qn=function(e,n){rn(n,mn),rn(n,ln),e.srcProfile&&0<e.srcProfile.length&&e.srcProfile.map(function(e){return e.refreshToken&&un.addRefreshToken(e.refreshToken)})},Vn=function(e,n){var t=n.map(function(e){return e.replace(/\|\|.*$/,"")}),a=[];return e.forEach(function(r){var e={};r.maskedCards&&(e.maskedCards=r.maskedCards,e.maskedCards.map(function(e){delete e.cardBrand,delete e.network,delete e.enrolledCard,delete e.enrollmentVerified})),r.maskedConsumer&&(e.maskedConsumer=r.maskedConsumer),r.idToken?e.idToken=r.idToken:e.idToken=t.find(function(e){var n=JSON.parse(atob(r.refreshToken.split(".")[1])),t=JSON.parse(atob(e.split(".")[1]));return n.sub===t.email}),a.push(e)}),a},Un=r.SRC_ID,Mn=r.BASE_KEYS_URL,Fn=r.SESSION_ID,Jn=r.SDK_API_NAME,Gn=b.isEmptyObject,Bn=b.initalizeCsrtEvent,Kn=e.SplunkEventName,jn=b.updateCsrtEvent,Hn=b.getChannelTypes,Yn=e.CsrtFieldName,zn=b.generateUUID,Xn=b.getTimeStamp,Qn=b.storeHeader,Wn=h.SDKErrorCodes,Zn=l.Options,$n=l.Service,et=window.Jose,nt=r.ACCESS_TOKEN,tt=r.API_TIMEOUT,rt=r.BASE_IDENTITY_URL,at=r.CORRELATION_ID,st=r.DPA_DATA,ot=r.DPA_TRANSACTION_DATA,it=r.INITIATOR_ID,ct=r.JSON_CONTENT_TYPE,dt=r.SRC_PROFILE,ut=r.SRC_TRANSACTION_ID,pt=r.TRANSACTION_ID,lt=Wn.identityLookup,It=Wn.standardErrorCodes,ft=Ce.getInstance();var mt=function(c,d,u,p){return new Promise(function(n,t){var e=null;if(p.find(function(e){return JSON.parse(atob(e.split(".")[1])).sub===u})){var r=JSON.parse(window.amexSrcInstance.getItem(dt)||"[]");r&&r.length&&(e=r.find(function(e){return e.consumerId===u}))}var a=function(e){n(d=e)},s=function(e){d.reason=e.reason,d.message=e.message,t(d)};if(Gn(e))St(c,u).then(function(e){return a(e)},function(e){return s(e)});else if(e.consumerLocked)d.reason=lt.ACCT_INACCESSIBLE.reason,d.message=lt.ACCT_INACCESSIBLE.message,t(d);else if(e.maskedCards){var o=btoa(c.identityValue);if(window.amexSrcInstance.setItem(Un,o),d.consumerPresent=!0,e.supportedValidationChannels)d.supportedValidationChannels=e.supportedValidationChannels;else{var i=window.amexSrcInstance.getItem(it);if(-1!==sms_otp_id_lookup_config.eligible.indexOf(i))return void St(c,u).then(function(e){return a(e)},function(e){return s(e)})}n(d),ft.deleteToken(u),St(c,u,!0)}else St(c,u).then(function(e){return a(e)},function(e){return s(e)})})},St=function(S,g,_){return new Promise(function(l,I){var f=new $n,m={};(function(u){return new Promise(function(d,n){(new $n).get(Mn+"/keys",function(e,n,t){var r=e.keys,a=new et.WebCryptographer;a.setKeyEncryptionAlgorithm("RSA-OAEP-256"),a.setContentEncryptionAlgorithm("A256GCM");var s=r.find(function(e){return"src-amex-card-enc-01"===e.kid});s.key_ops=["wrapKey","encrypt"];var o=et.Utils.importRsaPublicKey(s,"RSA-OAEP-256"),i=new et.JoseJWE.Encrypter(a,o);i.addHeader("kid","src-amex-card-enc-01");var c={email:u.identityValue.toLowerCase()};i.encrypt(JSON.stringify(c)).then(function(e){d(e)})},function(e){n("Failed to get keys")})})})(S).then(function(e){try{var n={consumerId:""};n.consumerId=e,window.amexSrcInstance.setItem(Un,btoa(S.identityValue.toLowerCase()));var t=window.amexSrcInstance.getItem(at),r=window.amexSrcInstance.getItem(nt),a=window.amexSrcInstance.getItem(it),s=window.amexSrcInstance.getItem(ut),o=window.amexSrcInstance.getItem(st)||"",i=window.amexSrcInstance.getItem(ot)||"",c=window.amexSrcInstance.getItem(pt);t&&r||(o&&(n.dpaData=JSON.parse(o)),i&&(n.dpaTransactionOptions=JSON.parse(i)));var d={"Accept-Language":"*","Content-Type":ct,RequestTimestamp:Xn(),SrcInitiatorId:a||null,SrcsTransactionId:s||null};S.invitation_id&&(d.AccessId=S.invitation_id),c&&(d.SrciTransactionId=c),r&&(d.AccessToken=r,t&&(d.SrcCorrelationId=t));var u=new Zn(rt+"/consumers","POST",JSON.stringify(n),d,tt,!0),p=function(e){try{var n=e.responseJSON||e;n&&0===n.status?(m.reason=It.REQUEST_TIMEOUT.reason,m.message=It.REQUEST_TIMEOUT.message):n&&"SRC_003"===n.status.code?(m.reason=lt.ID_FORMAT_UNSUPPORTED.reason,m.message=lt.ID_FORMAT_UNSUPPORTED.message):n&&"SRC_040"===n.status.code?(m.reason=lt.ACCT_INACCESSIBLE.reason,m.message=lt.ACCT_INACCESSIBLE.message):(m.reason=It.SERVER_ERROR.reason,m.message=It.SERVER_ERROR.message),I(m)}catch(e){m.message=e.message,I(m)}};_?f.request(u,function(e,n,t){},function(e){}):f.request(u,function(e,n,t){e.status&&e.status.code&&"0000"!==e.status.code?p(e):gt(e,t,g).then(function(e){l(e)})},function(e){p(e)})}catch(e){m.message=e.message,I(m)}}).catch(function(e){m.message=e.message,I(m)})})},gt=function(r,a,s){return new Promise(function(e){var n={};if(n.consumerPresent=r.consumerPresent,n.supportedValidationChannels=r.supportedValidationChannels,n.consumerPresent&&ft.deleteToken(s),r.refreshToken){var t=r.refreshToken;ft.addToken(t)}_t(r,a),e(n)})},_t=function(e,n){try{Qn(n,at),Qn(n,nt)}catch(e){console.log("Failed in identity lookup "+e)}},Tt=function(e){for(var n=e.toLowerCase(),t=[],r=0;r<n.length;r++)t.push(n.charCodeAt(r));var a=t;for(r=0;r<1e3;r++)a=Et(a);var s=Et(t),o=Array.from(s),i=Array.from(a),c=Et(o.concat(i)),d=String.fromCharCode.apply(null,Array.from(c));return btoa(d)};function Et(e){return window.sha256.digest(e)}var ht=r.MERCHANT_URL,Ct=r.SDK_API_NAME,Rt=r.EXTENSIVE_LOGGING,vt=r.CSRT_LOGGING,At=b.generateSRCUUID,Nt=(b.getTimeStamp,h.SDKErrorCodes),Ot=r.BASE_INAUTH_URL,yt=r.DPA_DATA,wt=r.DPA_TRANSACTION_DATA,Dt=r.INITIATOR_ID,kt=r.SRC_TRANSACTION_ID,bt=r.TRANSACTION_ID,Pt=Nt.init;function xt(_){var T={resolveIndex:_.resolveIndex,response:{}},E=T.response;return new Promise(function(e,n){try{window.amexSrcInstance.clear();var t=_.request,r=t.srcInitiatorId,a=t.dpaData,s=t.dpaTransactionOptions,o=t.srciTransactionId,i=t.version;if(!t)return E.reason=h.SDKErrorCodes.standardErrorCodes.INVALID_PARAMETER.reason,E.message=h.SDKErrorCodes.standardErrorCodes.INVALID_PARAMETER.message,void n(T);var c=("-dev"===P?x.sandbox:"-qa"===P||"-green-qa"===P?x.sandbox:x.production).find(function(e){return e.id===r});if(!r||!c)return E.reason=Pt.SRCI_ID_MISSING.reason,E.message=Pt.SRCI_ID_MISSING.message,void n(T);new V.Versioning(i,c);var d=V.Versioning.validateRequest(Ct.INIT,t);if(d.isError)return E.reason=d.error.reason,E.message=d.error.message,void n(T);if(a&&Object.keys(a).length){var u=t.dpaData;window.amexSrcInstance.setItem(yt,JSON.stringify(u))}if(window.amexSrcInstance.setItem(Rt,_.extensiveLogging),window.amexSrcInstance.setItem(vt,_.csrtLogging),_.merchantUrl&&window.amexSrcInstance.setItem(ht,_.merchantUrl),window.amexSrcInstance.setItem(Dt,r),window.amexSrcInstance.setItem(bt,o),s&&Object.keys(s).length){var p=s.paymentOptions;if(p&&null!==p.dynamicDataType&&void 0!==p.dynamicDataType){var l=[];Array.isArray(p.dynamicDataType)||(l.push(p.dynamicDataType),p.dynamicDataType=l)}s.paymentOptions=p,window.amexSrcInstance.setItem(wt,JSON.stringify(s))}var I=At();window.amexSrcInstance.setItem(kt,I);try{_e.getInstance().addSafariCookie()}catch(e){}var f=Ot+"/cc.js?&sid=ee490b8fb9a4d570&tid="+I+"&namespace=inauth",m=document.createElement("script");m.async=!0,m.setAttribute("src",f),document.head.appendChild(m);var S="\n    var inauth = inauth || {};\n    inauth._cc = inauth._cc || [];\n    inauth._cc.push([ 'ci',{'sid':'ee490b8fb9a4d570','tid':'"+I+"','clientName':'SRC'}]);\n    inauth._cc.push(['st',500]);\n    inauth._cc.push(['cf',134716403]);\n    inauth._cc.push(['run','"+Ot+"']);\n    function callCollector(callBackFunction) { inauth._cc.push([ 'cfp', callBackFunction ]); }",g=document.createElement("script");g.textContent=S,document.body.appendChild(g),e(T)}catch(e){E.message=e.message,n(T)}})}var Lt=b.getNavigatorLanguage,qt=r.SDK_API_NAME,Vt=r.SESSION_ID,Ut=r.SRC_ID,Mt=b.isEmpty,Ft=b.initalizeCsrtEvent,Jt=e.SplunkEventName,Gt=b.updateCsrtEvent,Bt=b.getChannelTypes,Kt=e.CsrtFieldName,jt=l.Options,Ht=l.Service,Yt=h.SDKErrorCodes,zt=r.ACCESS_TOKEN,Xt=r.API_TIMEOUT,Qt=r.BASE_IDENTITY_URL,Wt=r.CORRELATION_ID,Zt=r.INITIATOR_ID,$t=r.JSON_CONTENT_TYPE,er=r.SRC_TRANSACTION_ID,nr=r.TRANSACTION_ID,tr=Yt.initiateIdentityValidation,rr=Yt.standardErrorCodes;var ar=function(s,o,i,c){return new(i||(i=Promise))(function(e,n){function t(e){try{a(c.next(e))}catch(e){n(e)}}function r(e){try{a(c.throw(e))}catch(e){n(e)}}function a(n){n.done?e(n.value):new i(function(e){e(n.value)}).then(t,r)}a((c=c.apply(s,o||[])).next())})},sr=function(t,r){var a,s,o,e,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,s=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){i.label=n[1];break}if(6===n[0]&&i.label<o[1]){i.label=o[1],o=n;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(n);break}o[2]&&i.ops.pop(),i.trys.pop();continue}n=r.call(t,i)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}},or=r.SDK_API_NAME,ir=r.EXTENSIVE_LOGGING,cr=e.SplunkEventName,dr=e.CsrtFieldName,ur=b.getTimeStamp,pr=b.storeHeader,lr=b.initalizeCsrtEvent,Ir=b.updateCsrtEvent,fr=l.Options,mr=l.Service,Sr=r.ACCESS_TOKEN,gr=r.API_TIMEOUT,_r=r.BASE_PROFILE_URL,Tr=r.CORRELATION_ID,Er=r.DPA_DATA,hr=r.DPA_TRANSACTION_DATA,Cr=r.INITIATOR_ID,Rr=r.JSON_CONTENT_TYPE,vr=r.SRC_PROFILE,Ar=r.SRC_TRANSACTION_ID,Nr=r.TRANSACTION_ID;var Or=function(t){var s=[],o=[],i={},e=window.amexSrcInstance.getItem(Er)||"",n=window.amexSrcInstance.getItem(hr)||"",r=window.amexSrcInstance.getItem(Nr),c={url:_r+"/idtokens",crossDomain:!0,dataType:"json",headers:{"Accept-Language":"*","Content-Type":Rr,RequestTimestamp:ur(),SrcInitiatorId:window.amexSrcInstance.getItem(Cr),SrcsTransactionId:window.amexSrcInstance.getItem(Ar)},type:"POST"};r&&(c.headers.SrciTransactionId=r);var a={refreshTokens:[]};e&&(a.dpaData=JSON.parse(e)),n&&(a.dpaTransactionOptions=JSON.parse(n)),r&&(c.headers.SrciTransactionId=r),c.data=a;var d=new mr;return new Promise(function(r,n){if(t){try{t.map(function(e){JSON.parse(atob(e.split(".")[1])).ext_remember_me?s.push(e):o.push(e)})}catch(e){i.reason="Invalid Refresh Token",i.message=e.message,n(i)}if(s.length){c.data.refreshTokens=s,o.length&&(c.data.refreshTokens=c.data.refreshTokens.concat(o));e=new fr(c.url,c.type,JSON.stringify(c.data),c.headers,gr,!1);var a=!1;d.request(e,function(e,n,t){a=!0,yr(e,t).then(function(e){i.idTokens=e||[],i.recognized=0<i.idTokens.length,r(i)}).catch(function(){i.recognized=!1,r(i)})},function(e){pr(e,Sr),i.recognized=!1,r(i)}),setTimeout(function(){a||(i.recognized=!1,r(i))},5e3)}else if(o.length){c.data.refreshTokens=o;e=new fr(c.url,c.type,JSON.stringify(c.data),c.headers,gr,!0);d.request(e,function(e,n,t){yr(e,t).then(function(){i.recognized=!1,r(i)}).catch(function(){i.recognized=!1,r(i)})},function(e){pr(e,Sr),i.recognized=!1,r(i)})}}else{var e=new fr(c.url,c.type,JSON.stringify(c.data),c.headers,gr,!0);d.request(e,function(e,n,t){pr(t,Sr)},function(e){pr(e,Sr)})}})};function yr(i,c){var d=this;return new Promise(function(n,e){var t=[];if(pr(c,Tr),pr(c,Sr),i.srcProfile){var r=i.srcProfile,a=i.identityValidationChannels,s=_e.getInstance();s.clearAllRefreshTokens();var o=[];r.map(function(n){return ar(d,void 0,void 0,function(){return sr(this,function(e){return n.idToken&&t.push(n.idToken),n.refreshToken&&o.push(n.refreshToken),n.consumerId&&a&&a[n.consumerId]&&(n.supportedValidationChannels=a[n.consumerId]),[2]})})}),window.amexSrcInstance.setItem(vr,JSON.stringify(r)),s.addRefreshTokenArray(o).then(function(e){n(t)})}else e(t)})}var wr=function(){return(wr=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},Dr=b.getNavigatorLanguage,kr=r.SDK_API_NAME,br=r.DCF_PATH,Pr=b.isEmptyObject,xr=r.THREEDS_TRANS_ID,Lr=r.IGNORE_PAYLOAD,qr=r.PAYLOAD_TRANS_ID,Vr=b.updateCsrtEvent,Ur=e.CsrtFieldName,Mr=e.SplunkEventName,Fr=b.initalizeCsrtEvent,Jr=h.SDKErrorCodes,Gr=l.Options,Br=l.Service,Kr=r.ACCESS_TOKEN,jr=r.API_TIMEOUT,Hr=r.BASE_CHECKOUT_URL,Yr=r.CORRELATION_ID,zr=r.SRC_PROFILE,Xr=r.ID_TOKENS,Qr=r.INITIATOR_ID,Wr=r.JSON_CONTENT_TYPE,Zr=r.TRANSACTION_ID,$r=r.DPA_DATA,ea=r.DPA_TRANSACTION_DATA,na=r.SRC_TRANSACTION_ID,ta=Jr.checkout,ra=Jr.standardErrorCodes;function aa(i){var T={resolveIndex:i.resolveIndex,response:{}},E=T.response;return Fr(Mr.Checkout),new Promise(function(l,I){try{var e=_e.getInstance(),f=i.request,n=V.Versioning.validateRequest(kr.CHECKOUT,f);if(n.isError)return E.reason=n.error.reason,E.message=n.error.message,void I(T);var m=f.srcDigitalCardId;if(Vr(Ur.src_digital_card_Id,m,Mr.Checkout),f.dpaData&&window.amexSrcInstance.setItem($r,JSON.stringify(f.dpaData)),f.dpaTransactionOptions){var t=f.dpaTransactionOptions,r=t.paymentOptions;if(r&&null!==r.dynamicDataType&&void 0!==r.dynamicDataType){var a=[];Array.isArray(r.dynamicDataType)||(a.push(r.dynamicDataType),r.dynamicDataType=a)}t.paymentOptions=r,window.amexSrcInstance.setItem(ea,JSON.stringify(t))}f.srciTransactionId&&window.amexSrcInstance.setItem(Zr,f.srciTransactionId);var s=JSON.parse(window.amexSrcInstance.getItem(zr)||"[]"),o="",S={},g={};if(s.map(function(n){n.maskedCards&&n.maskedCards.find(function(e){e.srcDigitalCardId===m&&""===o&&(o=e,(S=n).checkoutCard=o)})}),o){var _=[];S.accessToken=window.amexSrcInstance.getItem(Kr),g.accessToken=window.amexSrcInstance.getItem(Kr),g.srcProfile=S,oa(S).then(function(d){var u=window.amexSrcInstance.getItem($r)||"",p=window.amexSrcInstance.getItem(ea)||"";e.getAllRefreshTokenFromCookie(function(e){e&&"error"!==e&&0!==e.length?e.map(function(e){_.push(e)}):_=[],function(){var e=window.amexSrcInstance.getItem(Yr),n=f.srciTransactionId,t={url:Hr+"/card/selectcard",crossDomain:!0,dataType:"json",headers:{"Accept-Language":"*","Content-Type":Wr,consumerId:S.consumerId,RequestTimestamp:b.getTimeStamp(),SrcCorrelationId:null!=e?e:(new Date).getTime().toString(),SrcInitiatorId:window.amexSrcInstance.getItem(Qr),SrcsTransactionId:window.amexSrcInstance.getItem(na),DigitalCardId:m,AccessToken:window.amexSrcInstance.getItem(Kr)},type:"POST"};n&&(t.headers.SrciTransactionId=n),S.idToken=d.selectedIdToken;var r={refreshToken:d.selectedRFToken,idToken:d.selectedIdToken,browserLocale:Dr()};u&&(r.dpaData=JSON.parse(u)),p&&(r.dpaTransactionOptions=JSON.parse(p));var a=f.payloadTypeIndicatorCheckout,s=f.payloadTypeIndicatorPayload;a&&(r.payloadTypeIndicatorCheckout=a),s&&(r.payloadTypeIndicatorPayload=s),t.data=r;var o=new Br,i=new Gr(t.url,t.type,JSON.stringify(t.data),t.headers,jr,!0),c=function(e,n){var t=e.responseJSON||e;if(t&&0===t.status)return E.reason=ra.REQUEST_TIMEOUT.reason,E.message=ra.REQUEST_TIMEOUT.message,void I(T);t?"SRC_041"===t.status.code||"SRC_005"===t.status.code?(E.srcProfile=wr({},n,t),E.reason=ta.ACCT_INACCESSIBLE.reason,E.message=ta.ACCT_INACCESSIBLE.message,I(T)):"SRC_043"===t.status.code?(E.srcProfile=t,E.srcProfile.refreshTokens=_,E.nextStep=br.ERROR,E.status=t.status,l(T)):(E.reason=ra.SERVER_ERROR.reason,E.message=ra.SERVER_ERROR.message,I(T)):(E.reason=ra.SERVER_ERROR.reason,E.message=ra.SERVER_ERROR.message,I(T))};o.request(i,function(e,n,t){e.status.code&&"0000"===e.status.code?sa(e,t,g,S).then(function(e){E.nextStep=e.nextStep,E.srcProfile=e.srcProfile,l(T)}).catch(function(e){E.message=e.message,I(T)}):c(e,S)},function(e){c(e,S)})}()})}).catch(function(e){E.reason="Device is not capable of storing cookie",E.message="NO_COOKIE_FOUND",I(T)})}else E.reason="No Card Found",E.message="CARD_ID_NOT_VALID",I(T)}catch(e){E.message=e.message,I(T)}})}var sa=function(p,e,l,I){return new Promise(function(e,n){try{var t=_e.getInstance(),r={},a=p.nextStep,s=null;if(I){var o=I.refreshToken,i=JSON.parse(atob(o.split(".")[1]));t.getAllRefreshTokenFromCookie(function(e){e&&"error"!==e&&0!==e.length?e.find(function(e){var n=JSON.parse(atob(e.split(".")[1]));i.sub===n.sub&&(s=e)}):s=o})}if(window.amexSrcInstance.setItem(Lr,!!p.payloadThreeDSServerTransId),p.stepUpThreeDSServerTransId||p.payloadThreeDSServerTransId){var c=p.stepUpThreeDSServerTransId||p.payloadThreeDSServerTransId;p.threeDSServerTransID=c,window.amexSrcInstance.setItem(xr,c),p.payloadThreeDSServerTransId&&window.amexSrcInstance.setItem(qr,p.payloadThreeDSServerTransId)}var d="prop";if(p.responseMetaData)d="001"!==p.responseMetaData.issuerCode?"/issuer":"/prop";if("0000"!==p.status.code||"sendOTP"!==a&&"cid"!==a)if("0000"===p.status.code&&"review"===a)l.srcProfile.refreshToken=s,l.srcProfile.cardExpired=p.cardExpired||!1,l.srcProfile.otpVerified=p.otpVerified||!1,l.srcProfile.idToken=I.idToken,l.srcProfile.preferredLocale=p.preferredLocale,l.srcProfile.allowedLocales=p.allowedLocales,l.srcProfile.shippingAddress=p.shippingAddress||[],l.srcProfile.disableShippingAddress=p.disableShippingAddress||!1,l.srcProfile.shippingAddressMaxed=p.shippingAddressMaxed||!1,l.srcProfile.checkoutCard.enrollmentVerified=p.enrollmentVerified||!1,l.srcProfile.maskedConsumer=p.maskedConsumer,Pr(l.srcProfile.maskedConsumer)||Pr(l.srcProfile.maskedConsumer.maskedConsumerIdentity)||(l.srcProfile.maskedConsumer.fullName=l.srcProfile.maskedConsumer.maskedFullName,l.srcProfile.maskedConsumer.emailAddress=l.srcProfile.maskedConsumer.maskedConsumerIdentity.maskedIdentityValue),l.srcProfile.stepUpThreeDSServerTransId=p.stepUpThreeDSServerTransId,l.srcProfile.payloadThreeDSServerTransId=p.payloadThreeDSServerTransId,l.srcProfile.threeDSServerTransID=p.threeDSServerTransID,l.srcProfile.doRate=p.doRate||!1,l.srcProfile.maskedAddress=p.maskedAddress||!1,l.srcProfile.defaultRememberMe=p.defaultRememberMe||!1,(r=l).nextStep=d+br.REVIEW,p.responseMetaData&&(l.srcProfile.responseMetaData=p.responseMetaData),l.srcProfile.tenuredChannels=p.tenuredChannels,e(r);else if("0000"===p.status.code&&"skFlow"===a){var u;(u=p).srcCorrelationId=window.amexSrcInstance.getItem(Yr),u.srcsTransactionId=window.amexSrcInstance.getItem(na),u.srcInitiatorId=window.amexSrcInstance.getItem(Qr),u.accessToken=window.amexSrcInstance.getItem(Kr),u.refreshToken=s,u.checkoutCard=I.checkoutCard,r.nextStep=br.SAFEKEY,r.srcProfile=u,e(r)}else e(r);else(u=p).refreshToken=s,u.accessToken=window.amexSrcInstance.getItem(Kr)||"",r.srcProfile=u,r.srcProfile.idToken=I.idToken,r.nextStep="sendOTP"===a?d+br.SEND_OTP:d+br.CID,e(r)}catch(e){n(e)}})},oa=function(n){return new Promise(function(t,r){var e=_e.getInstance(),a=n.refreshToken,s=JSON.parse(atob(a.split(".")[1])),o="",i="";e.getAllRefreshTokenFromCookie(function(e){if(o=e&&"error"!==e&&0!==e.length?e.find(function(e){return JSON.parse(atob(e.split(".")[1])).sub===s.sub}):a){var n=JSON.parse(window.amexSrcInstance.getItem(Xr)||"[]");i=n.find(function(e){var n=JSON.parse(atob(e.split(".")[1]));return JSON.parse(atob(o.split(".")[1])).sub===n.email}),t({selectedRFToken:o,selectedIdToken:i})}else r("No Cookie Found")})})},ia=r.SRC_PROFILE,ca=r.SDK_API_NAME,da=b.updateCsrtEvent,ua=e.CsrtFieldName,pa=e.SplunkEventName,la=b.initalizeCsrtEvent;var Ia=b.getTimeStamp,fa=r.CORRELATION_ID,ma=r.BASE_IDENTITY_URL,Sa=r.SDK_API_NAME,ga=b.initalizeCsrtEvent,_a=e.SplunkEventName,Ta=b.updateCsrtEvent,Ea=e.CsrtFieldName,ha=h.SDKErrorCodes,Ca=ha.unbindAppInstance,Ra=ha.standardErrorCodes,va=l.Options,Aa=l.Service,Na=r.API_TIMEOUT,Oa=r.INITIATOR_ID,ya=r.JSON_CONTENT_TYPE,wa=r.SRC_TRANSACTION_ID,Da=_e.getInstance();var ka,ba,Pa,xa,La,qa,Va,Ua,Ma,Fa,Ja=function(c,d){var u={};return new Promise(function(r,n){try{var e=window.amexSrcInstance.getItem(fa),a=[],s=[];if(c.map(function(e){JSON.parse(atob(e.split(".")[1])).ext_remember_me&&a.push(e)}),0===a.length)return u.srcCorrelationId=e,void r(u);Ta(Ea.unbind_idtoken_cnt,String(d.length),_a.UnbindAppInstance),d.map(function(e){var t=JSON.parse(atob(e.split(".")[1])),r=!1;a.map(function(e){var n=JSON.parse(atob(e.split(".")[1]));r||n.sub===t.email&&(r=!0,s.push(e))})});var t=new Aa,o={url:ma+"/unbind",crossDomain:!0,dataType:"json",headers:{"Accept-Language":"*","Content-Type":ya,RequestTimestamp:Ia(),SrcInitiatorId:window.amexSrcInstance.getItem(Oa),SrcsTransactionId:window.amexSrcInstance.getItem(wa),SrcCorrelationId:e},type:"POST"};o.data={refreshTokens:s,idTokens:d};var i=new va(o.url,o.type,JSON.stringify(o.data),o.headers,Na,!1);t.request(i,function(e,n,t){e.status&&e.status.code&&"0000"!==e.status.code?Ga(e):(e.refreshTokens.map(function(e){Da.addRefreshToken(e)}),u.srcCorrelationId=t.getResponseHeader(fa)||"",r(u))},function(e){Ga(e).catch(function(e){n(e)})})}catch(e){u.message=e.message,n(u)}})},Ga=function(e){var r=e.responseJSON||e;return new Promise(function(e,n){var t={};r&&0===r.status?(t.reason=Ra.REQUEST_TIMEOUT.reason,t.message=Ra.REQUEST_TIMEOUT.message):r&&"SRC_008"===r.status.code?(t.reason=Ca.RT_VERIFICATION_FAILED.reason,t.message=Ca.RT_VERIFICATION_FAILED.message):r&&"SRC_010"===r.status.code?(t.reason=Ca.ID_TOKEN_VERIFICATION_FAILED.reason,t.message=Ca.ID_TOKEN_VERIFICATION_FAILED.message):(t.reason=Ra.SERVER_ERROR.reason,t.message=Ra.SERVER_ERROR.message),n(t)})},Ba=b.objectToBase64,Ka=r.AMEX_DCF_URL,ja=l.Options,Ha=l.Service;ba=ka||(ka={}),Pa=r.AMEX_SRCI_URL,xa=r.BASE_PING_URL,La=r.JSON_CONTENT_TYPE,qa=r.API_TIMEOUT,Va=r.THREEDS_TRANS_ID,Ua=r.BASE_SAFEKEY_URL,Ma=b.getTimeStamp,Fa=r.SRC_TRANSACTION_ID,ba.threeDSMethodPost=function(e){var n=e.data,t=n.threeDsData,r=n.threeDsUrl,a={eventName:"3ds",eventData:Ba(t),eventUrl:r};document.getElementById("safeKeyIframe").contentWindow.postMessage(a,Ka)},ba.createSafekeyIframe=function(){var e=document.createElement("iframe");e.frameBorder="0",e.width="0px",e.height="0px",e.id="safeKeyIframe",e.name="safeKeyIframe",e.setAttribute("src",r.AMEX_DCF_URL+"/safekeyIframe.html"),e.setAttribute("style","display:none;position:absolute;width:0px;height:0px;border:none;left:-100px;top:-100px;"),document.body.appendChild(e)},ba.pingCreqResponse=function(){var e=setTimeout(function(){return window.parent.postMessage(JSON.stringify({eventName:"DCF_CREQ_NO_RESPONSE"}),Pa),o(),!0},66e4),r=window.amexSrcInstance.getItem(Va),n=function(){var e={url:xa+"/transactions/skstatus/"+r+"/rreqStatus",crossDomain:!0,dataType:"json",headers:{Accept:"application/json, text/plain, */*","Accept-Language":"*","Content-Type":La,RequestTimestamp:Ma()},type:"GET"},n=new Ha,t=new ja(e.url,e.type,"",e.headers,3e3,!0);n.request(t,function(e,n,t){var r=e.status;if(r)if("SRC_060"===r.code){o();var a={eventName:"DCF_CHECKOUT_RESPONSE",eventData:s={checkoutResponseSignature:null,checkoutResponse:{},dcfActionCode:"CANCEL"}};window.parent.postMessage(JSON.stringify(a),Pa)}else if("SRC_062"===r.code){o();var s={eventName:"DCF_CREQ_NO_RESPONSE"};window.parent.postMessage(JSON.stringify(s),Pa)}else"0000"===r.code&&o()},function(e){})};n();var t=setInterval(n,3e4),o=function(){clearInterval(t),clearTimeout(e)};return o},ba.notifyCreq=function(c){return new Promise(function(e,n){var t=JSON.parse(atob(c));window.amexSrcInstance.setItem(Va,t.threeDSServerTransID);var r=t.threeDSServerTransID,a=window.amexSrcInstance.getItem(Fa),s={url:Ua+"/transactions/"+r+"/safekeychallenge",crossDomain:!0,dataType:"json",headers:{Accept:"application/json, text/plain, */*","Accept-Language":"*","Content-Type":La,RequestTimestamp:Ma(),SrcsTransactionId:a},type:"POST",data:{creqData:c}},o=new Ha,i=new ja(s.url,s.type,JSON.stringify(s.data),s.headers,qa,!1);o.request(i,function(e,n,t){},function(e){}),e(ba.pingCreqResponse())})},ba.clearTimers=function(e,n){clearInterval(n),clearTimeout(e)};var Ya,za=r.SDK_API_NAME,Xa=r.IGNORE_PAYLOAD,Qa=b.stringToBool,Wa=b.updateCsrtEvent,Za=e.CsrtFieldName,$a=e.SplunkEventName,es=r.AMEX_SRCI_URL,ns=function(e,n,t){return n||(Wa(Za.sdk_err_cd,e.response.reason,t||""),Wa(Za.sdk_err_desc,e.response.message,t||"")),e.resolve=n,e};window.amexSrcInstance=(Ya={},{getItem:function(e){return Ya[e]},setItem:function(e,n){Ya[e]=n.toString()},clear:function(){Ya={}},removeItem:function(e){delete Ya[e]},getAll:function(){return Ya}});var ts=function(e){if(e.origin)try{var n=JSON.parse(e.data);switch(n.method){case"READY":!function(e){var n={value:"READY"};n.resolveIndex=e._resolveIndex,n.resolve=!0,window.parent.postMessage(n,es)}(n);break;case za.INIT:!function(e){xt(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.Init),es)})}(n);break;case za.IS_RECOGNIZED:!function(e){(function(s){var o={resolveIndex:s.resolveIndex,response:{}},i=o.response;return new Promise(function(t,r){try{var e=_e.getInstance(),n=s.request;lr(cr.IsRecognized);var a=V.Versioning.validateRequest(or.IS_RECOGNIZED,n);if(a.isError)return i.reason=a.error.reason,i.message=a.error.message,void r(o);e.getAllRefreshTokenFromCookie(function(e){if(e&&0!==e.length&&"error"!==e)Or(e).then(function(e){o.response=V.Versioning.buildResponse(or.IS_RECOGNIZED,e),Ir(dr.is_recognized,o.response.recognized,cr.IsRecognized),t(o)},function(e){i.reason=e.reason,i.message=e.message,r(o)});else{i.recognized=!1,Ir(dr.is_recognized,i.recognized,cr.IsRecognized),o.response=V.Versioning.buildResponse(or.IS_RECOGNIZED,i),t(o);var n=b.stringToBool(window.amexSrcInstance.getItem(ir));window.amexSrcInstance.setItem("dontLogIsReconized",!n),n&&Or()}})}catch(e){i.message=e.message,r(o)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.IsRecognized),es)})}(n);break;case za.ID_LOOKUP:!function(e){(function(c){var d=_e.getInstance(),u={response:{},resolveIndex:c.resolveIndex},p=u.response;return new Promise(function(t,n){try{var r=c.request;Bn(Kn.IdLookup);var e=V.Versioning.validateRequest(Jn.ID_LOOKUP,r);if(e.isError)return p.reason=e.error.reason,p.message=e.error.message,void n(u);window.amexSrcInstance.setItem(Fn,zn());var a=r.identityValue.toLowerCase();jn(Yn.consumer_identity_value,a,Kn.IdLookup);var s=Tt(a),o=function(e){p=V.Versioning.buildResponse(Jn.ID_LOOKUP,e),jn(Yn.consumer_present,p.consumerPresent,Kn.IdLookup);var n=Hn(p.supportedValidationChannels);n&&jn(Yn.supported_validation_channels_type,n,Kn.IdLookup),u.response=p,t(u)},i=function(e){u.response=e,n(u)};d.getAllRefreshTokenFromCookie(function(e){e&&0!==e.length&&"error"!==e?mt(r,p,s,e).then(function(e){return o(e)},function(e){return i(e)}):St(r,s).then(function(e){return o(e)},function(e){return i(e)})})}catch(e){p.message=e.message,n(u)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.IdLookup),es)})}(n);break;case za.GET_SRC_PROFILE:!function(e){(function(u){var p={resolveIndex:u.resolveIndex,response:{}},l=p.response;return an(en.GetSrcProfile),new Promise(function(n,t){try{var r=Ce.getInstance(),e=u.request,a=V.Versioning.validateRequest($e.GET_SRC_PROFILE,e);if(a.isError)return l.reason=a.error.reason,l.message=a.error.message,void t(p);if(!Ze(e))return l.reason=h.SDKErrorCodes.getSrcProfile.AUTH_INVALID.reason,l.message=h.SDKErrorCodes.getSrcProfile.AUTH_INVALID.message,void t(p);window.amexSrcInstance.setItem(_n,JSON.stringify(e));var s=[],o=e,i=null,c=!1,d=(new Date).getTime()/1e3;if(o.reduce(function(e,n,t){var r=b.getPropertyFromToken(n,"exp");return c=r<d,r&&e<r?(i=t,r):e},0),c)return l.reason=yn.AUTH_INVALID.reason,l.message=yn.AUTH_INVALID.message,void t(p);null!==i&&window.amexSrcInstance.setItem(On,o[i]),o.map(function(n){var e=r.getTokensWithoutPromise();if(0<e.length){var t=JSON.parse(atob(n.split(".")[1]));e.map(function(e){JSON.parse(atob(e.split(".")[1])).sub!==t.email&&-1===s.indexOf(n)&&s.push(n)})}else 0===e.length&&(s=o)}),s&&s.length?un.getAllRefreshTokenFromCookie(function(e){e&&"error"!==e&&0!==e.length?Dn(e,o).then(function(e){l.profiles=e.srcProfile,l.srcCorrelationId=window.amexSrcInstance.getItem(mn)||"",p.response=V.Versioning.buildResponse($e.GET_SRC_PROFILE,l),sn(nn.no_of_profiles_returned,String(p.response.profiles.length),en.GetSrcProfile),n(p)}).catch(function(e){l.reason=e.reason,l.message=e.message,t(p)}):bn(o).then(function(e){l.profiles=e.srcProfile,l.srcCorrelationId=window.amexSrcInstance.getItem(mn)||"",p.response=V.Versioning.buildResponse($e.GET_SRC_PROFILE,l),sn(nn.no_of_profiles_returned,String(p.response.profiles.length),en.GetSrcProfile),n(p)}).catch(function(e){l.reason=e.reason,l.message=e.message,t(p)})}):(l.message=yn.EMPTY_PROFILES.message,l.reason=yn.EMPTY_PROFILES.reason,t(p))}catch(e){l.message=e.message,t(p)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.GetSrcProfile),es)})}(n);break;case za.CHECKOUT:!function(e){e.request.encryptedCard?Qe(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.Checkout),es)}):aa(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){var n=ns(e,!1,$a.Checkout);n.profileStepUpRequired&&delete n.profileStepUpRequired,window.parent.postMessage(n,es)})}(n);break;case za.CHECKOUT_COMPLETE:!function(e){(function(r){var a={resolveIndex:r.resolveIndex,response:{}};return la(pa.CheckoutComplete),new Promise(function(e,n){try{var t=r.request;t.refreshToken&&_e.getInstance().addRefreshToken(t.refreshToken),"CHANGE_CARD"===t.dcfActionCode&&window.amexSrcInstance.removeItem(ia),da(ua.checkout_response_signature,t.checkoutResponseSignature,pa.CheckoutComplete),da(ua.dcf_action_code,t.dcfActionCode,pa.CheckoutComplete),da(ua.unbind_app_instance,String(t.unbindAppInstance),pa.CheckoutComplete),a.response={checkoutResponse:t.checkoutResponse||null,checkoutResponseSignature:t.checkoutResponseSignature||null,dcfActionCode:t.dcfActionCode,unbindAppInstance:t.unbindAppInstance||!1,idToken:t.idToken},a.response=V.Versioning.buildResponse(ca.CHECKOUT,a.response),a.pandaYellow=t.pandaYellow||!1,e(a)}catch(e){a.response.message=e.message,n(a)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.CheckoutComplete),es)})}(n);break;case za.INITIATE_ID_VALIDATION:!function(e){(function(p){var l={resolveIndex:p.resolveIndex,response:{}},I=l.response;return Ft(Jt.InitIdValidation),new Promise(function(a,t){try{var e=p.request,n=V.Versioning.validateRequest(qt.INITIATE_ID_VALIDATION,e);if(n.isError)return I.reason=n.error.reason,I.message=n.error.message,void t(l);var r=window.amexSrcInstance.getItem(Vt),s=window.amexSrcInstance.getItem(Wt),o=window.amexSrcInstance.getItem(nr),i={url:Qt+"/consumers/"+r+"/authentications",crossDomain:!0,dataType:"json",headers:{"Accept-Language":"*","Content-Type":$t,RequestTimestamp:b.getTimeStamp(),SrcCorrelationId:null!=s?s:(new Date).getTime().toString(),SrcInitiatorId:window.amexSrcInstance.getItem(Zt),SrcsTransactionId:window.amexSrcInstance.getItem(er),AccessToken:window.amexSrcInstance.getItem(zt)},data:{consumerId:window.amexSrcInstance.getItem(Ut),browserLocale:Lt()},type:"POST"};Mt(e)||(i.data.requestedValidationChannelId=e),o&&(i.headers.SrciTransactionId=o);var c=new Ht,d=new jt(i.url,i.type,JSON.stringify(i.data),i.headers,Xt,!0),u=function(e){var n=e.responseJSON||e;n&&0===n.status?(I.reason=rr.REQUEST_TIMEOUT.reason,I.message=rr.REQUEST_TIMEOUT.message):n&&"SRC_035"===n.status.code?(I.reason=tr.RETRIES_EXCEEDED.reason,I.message=tr.RETRIES_EXCEEDED.message):n&&"SRC_053"===n.status.code?(I.reason=tr.UNRECOGNIZED_CONSUMER_ID.reason,I.message=tr.UNRECOGNIZED_CONSUMER_ID.message):n&&"SRC_021"===n.status.code?(I.reason=tr.OPT_SEND_FAILED.reason,I.message=tr.OPT_SEND_FAILED.message):(I.reason=rr.SERVER_ERROR.reason,I.message=rr.SERVER_ERROR.message),t(l)};c.request(d,function(e,n,t){if(e.status&&e.status.code&&"0000"!==e.status.code)u(e);else{I.maskedValidationChannel=e.maskedChannel,I.validationMessage=e.validationMessage,I.supportedValidationChannels=e.supportedValidationChannels,l.response=V.Versioning.buildResponse(qt.INITIATE_ID_VALIDATION,I),Gt(Kt.masked_validation_channel,I.maskedValidationChannel,Jt.InitIdValidation);var r=Bt(I.supportedValidationChannels);r&&Gt(Kt.supported_validation_channels_type,r,Jt.InitIdValidation),a(l)}},function(e){u(e)})}catch(e){I.message=e.message,t(l)}})})(e).then(function(e){var n=ns(e,!0);window.parent.postMessage(n,"*")}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.InitIdValidation),es)})}(n);break;case za.COMPLETE_ID_VALIDATION:!function(e){(function(p){var l={resolveIndex:p.resolveIndex,response:{}},I=l.response;return X(Q.CompleteIdValidation),new Promise(function(r,t){try{var e=p.request,n=V.Versioning.validateRequest(Y.COMPLETE_ID_VALIDATION,e);if(n.isError)return I.reason=n.error.reason,I.message=n.error.message,void t(l);W(Z.auth_code_value,e,Q.CompleteIdValidation);var a=window.amexSrcInstance.getItem(z),s=window.amexSrcInstance.getItem(ie),o=window.amexSrcInstance.getItem(pe),i={url:oe+"/consumers/"+a+"/idtokens",crossDomain:!0,dataType:"json",headers:{"Accept-Language":"*","Content-Type":de,RequestTimestamp:ee(),SrcCorrelationId:null!=s?s:(new Date).getTime().toString(),SrcInitiatorId:window.amexSrcInstance.getItem(ce),SrcsTransactionId:window.amexSrcInstance.getItem(ue),AccessToken:window.amexSrcInstance.getItem(ae)},data:{authcode:e},type:"POST"};o&&(i.headers.SrciTransactionId=o);var c=new te,d=new ne(i.url,i.type,JSON.stringify(i.data),i.headers,se,!0),u=function(e){var n=e.responseJSON||e;n&&0===n.status?(I.reason=Ie.REQUEST_TIMEOUT.reason,I.message=Ie.REQUEST_TIMEOUT.message):"SRC_037"===n.status.code?(I.reason=le.CODE_INVALID.reason,I.message=le.CODE_INVALID.message):"SRC_036"===n.status.code?(I.reason=le.CODE_EXPIRED.reason,I.message=le.CODE_EXPIRED.message):"SRC_035"===n.status.code?(I.reason=le.RETRIES_EXCEEDED.reason,I.message=le.RETRIES_EXCEEDED.message):"SRC_040"===n.status.code?(I.reason=le.ACCT_INACCESSIBLE.reason,I.message=le.ACCT_INACCESSIBLE.message):(I.reason=Ie.SERVER_ERROR.reason,I.message=Ie.SERVER_ERROR.message),t(l)};c.request(d,function(e,n,t){e.status&&e.status.code&&"0000"!==e.status.code?u(e):(e.idToken&&(I.idToken=e.idToken),l.response=V.Versioning.buildResponse(Y.COMPLETE_ID_VALIDATION,I),r(l))},function(e){u(e)})}catch(e){I.message=e.message,t(l)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.CompleteIdValidation),es)})}(n);break;case za.UNBIND:!function(e){(function(a){var s={resolveIndex:a.resolveIndex,response:{}},o=s.response;return ga(_a.UnbindAppInstance),new Promise(function(n,t){try{var r=a.request,e=V.Versioning.validateRequest(Sa.UNBIND,r);if(e.isError)return o.reason=e.error.reason,o.message=e.error.message,void t(s);Da.getAllRefreshTokenFromCookie(function(e){e&&0!==e.length&&"error"!==e?Ja(e,r).then(function(e){o.srcCorrelationId=e.srcCorrelationId,o=V.Versioning.buildResponse(Sa.UNBIND,o),n(s)},function(e){o.reason=e.reason,o.message=e.message,t(s)}):(o.reason="NO_COOKIE_EXISTS",o.message="Invalid Request to the service",t(s))})}catch(e){o.message=e.message,t(s)}})})(e).then(function(e){window.parent.postMessage(ns(e,!0),es)}).catch(function(e){window.parent.postMessage(ns(e,!1,$a.UnbindAppInstance),es)})}(n);break;case"notifyCreq":!function(e){ka.notifyCreq(e.request).then(function(e){})}(n);break;case"inVoke3ds":ka.threeDSMethodPost(n);break;case"DATA_REQUIRED":!function(){var e=window.amexSrcInstance.getAll(),n=Qa(window.amexSrcInstance.getItem(Xa))?null:window.getPayload(),t={eventName:"DATA_REQUIRED_RESPONSE",eventData:{session:e,payload:n}};window.parent.postMessage(JSON.stringify(t),es)}();break;case"LOG_SESSION":!function(){var e=window.amexSrcInstance.getAll();console.log("Amex Session",e)}();break;case"LOG_API":!function(e){!function(e){try{if(!e)return;var n=e.data,t=b.stringToBool(window.amexSrcInstance.getItem(u)),r=b.stringToBool(window.amexSrcInstance.getItem(d)),a=b.stringToBool(window.amexSrcInstance.getItem("dontLogIsReconized"));if(r&&m(n.event),n.event.eventName===v.Init&&!t)return;if(n.event.eventName===v.IsRecognized&&a)return;var s=window.amexSrcInstance.getItem(C)||"";window.amexSrcInstance.getItem(R)||s?(I(),f(n)):e.isInitReject?f(n):p.push(n)}catch(e){console.log(e)}}(e)}(n)}}catch(e){}};window.addEventListener?window.addEventListener("message",ts,!1):window.attachEvent("onmessage",ts,!1),setTimeout(function(){window.parent.postMessage(JSON.stringify({eventName:"AMEX_READY"}),es)},0),ka.createSafekeyIframe();